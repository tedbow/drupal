/**
* DO NOT EDIT THIS FILE.
* See the following change record for more information,
* https://www.drupal.org/node/2815083
* @preserve
**/

(function ($, Drupal, debounce, displace) {

  'use strict';

  function resetSize(event) {
    var offCanvasDialog = event.data.offCanvasDialog;
    var offsets = displace.offsets;
    var $element = event.data.$element;
    var container = offCanvasDialog.getContainer($element);

    var adjustedOptions = {
      position: {
        my: offCanvasDialog.getEdge() + ' top',
        at: offCanvasDialog.getEdge() + ' top' + (offsets.top !== 0 ? '+' + offsets.top : ''),
        of: window
      }
    };

    container.css({
      position: 'fixed',
      height: $(window).height() - (offsets.top + offsets.bottom) + 'px'
    });

    $element.dialog('option', adjustedOptions).trigger('dialogContentResize.off-canvas');
  }

  function handleDialogResize(event) {
    var $element = event.data.$element;
    var offCanvasDialog = event.data.offCanvasDialog;
    var $container = offCanvasDialog.getContainer($element);

    var $offsets = $container.find('> :not(#drupal-off-canvas, .ui-resizable-handle)');
    var offset = 0;
    var modalHeight;

    $element.css({ height: 'auto' });
    modalHeight = $container.height();
    $offsets.each(function () {
      offset += $(this).outerHeight();
    });

    var scrollOffset = $element.outerHeight() - $element.height();
    $element.height(modalHeight - offset - scrollOffset);
  }

  function bodyPadding(event) {
    var offCanvasDialog = event.data.offCanvasDialog;
    if ($('body').outerWidth() < offCanvasDialog.minDisplaceWidth) {
      return;
    }
    var $element = event.data.$element;
    var $container = offCanvasDialog.getContainer($element);
    var $mainCanvasWrapper = offCanvasDialog.$mainCanvasWrapper;

    var width = $container.outerWidth();
    var mainCanvasPadding = $mainCanvasWrapper.css('padding-' + offCanvasDialog.getEdge());
    if (width !== mainCanvasPadding) {
      $mainCanvasWrapper.css('padding-' + offCanvasDialog.getEdge(), width + 'px');
      $container.attr('data-offset-' + offCanvasDialog.getEdge(), width);
      displace();
    }
  }

  Drupal.offCanvas = {
    minDisplaceWidth: 768,

    $mainCanvasWrapper: $('[data-off-canvas-main-canvas]'),

    isOffCanvas: function isOffCanvas(dialog, $element, settings) {
      return $element.is('#drupal-off-canvas');
    },
    open: function open(event, dialog, $element, settings) {
      $('body').addClass('js-tray-open');
      settings.dialogClass += ' ui-dialog-off-canvas';

      settings.position = {
        my: 'left top',
        at: this.getEdge() + ' top',
        of: window
      };

      settings.height = $(window).height();
    },
    close: function close(event, dialog, $element) {
      $('body').removeClass('js-tray-open');

      $(document).off('.off-canvas');
      $(window).off('.off-canvas');
      this.$mainCanvasWrapper.css('padding-' + this.getEdge(), 0);
    },
    render: function render(event, dialog, $element, settings) {
      var eventData = { settings: settings, $element: $element, offCanvasDialog: this };
      $('.ui-dialog-off-canvas, .ui-dialog-off-canvas .ui-dialog-titlebar').toggleClass('ui-dialog-empty-title', !settings.title);

      $element.on('dialogresize.off-canvas', eventData, debounce(bodyPadding, 100)).on('dialogContentResize.off-canvas', eventData, handleDialogResize).on('dialogContentResize.off-canvas', eventData, debounce(bodyPadding, 100)).trigger('dialogresize.off-canvas');

      this.getContainer($element).attr('data-offset-' + this.getEdge(), '');

      $(window).on('resize.off-canvas scroll.off-canvas', eventData, debounce(resetSize, 100)).trigger('resize.off-canvas');
    },
    handleDialogResize: handleDialogResize,
    resetSize: resetSize,
    bodyPadding: bodyPadding,
    getContainer: function getContainer($element) {
      return $element.dialog('widget');
    },

    getEdge: function getEdge() {
      return document.documentElement.dir === 'rtl' ? 'left' : 'right';
    }
  };

  Drupal.behaviors.offCanvasEvents = {
    attach: function attach() {
      $(window).once('off-canvas').on({
        'dialog:beforecreate': function dialogBeforecreate(event, dialog, $element, settings) {
          if (Drupal.offCanvas.isOffCanvas(dialog, $element, settings)) {
            Drupal.offCanvas.open(event, dialog, $element, settings);
          }
        },
        'dialog:aftercreate': function dialogAftercreate(event, dialog, $element, settings) {
          if (Drupal.offCanvas.isOffCanvas(dialog, $element, settings)) {
            Drupal.offCanvas.render(event, dialog, $element, settings);
          }
        },
        'dialog:beforeclose': function dialogBeforeclose(event, dialog, $element) {
          if (Drupal.offCanvas.render(event, dialog, $element, settings)) {
            Drupal.offCanvas.close(event, dialog, $element);
          }
        }
      });
    }
  };
})(jQuery, Drupal, Drupal.debounce, Drupal.displace);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm9mZi1jYW52YXMuZXM2LmpzIl0sIm5hbWVzIjpbIiQiLCJEcnVwYWwiLCJkZWJvdW5jZSIsImRpc3BsYWNlIiwicmVzZXRTaXplIiwiZXZlbnQiLCJvZmZDYW52YXNEaWFsb2ciLCJkYXRhIiwib2Zmc2V0cyIsIiRlbGVtZW50IiwiY29udGFpbmVyIiwiZ2V0Q29udGFpbmVyIiwiYWRqdXN0ZWRPcHRpb25zIiwicG9zaXRpb24iLCJteSIsImdldEVkZ2UiLCJhdCIsInRvcCIsIm9mIiwid2luZG93IiwiY3NzIiwiaGVpZ2h0IiwiYm90dG9tIiwiZGlhbG9nIiwidHJpZ2dlciIsImhhbmRsZURpYWxvZ1Jlc2l6ZSIsIiRjb250YWluZXIiLCIkb2Zmc2V0cyIsImZpbmQiLCJvZmZzZXQiLCJtb2RhbEhlaWdodCIsImVhY2giLCJvdXRlckhlaWdodCIsInNjcm9sbE9mZnNldCIsImJvZHlQYWRkaW5nIiwib3V0ZXJXaWR0aCIsIm1pbkRpc3BsYWNlV2lkdGgiLCIkbWFpbkNhbnZhc1dyYXBwZXIiLCJ3aWR0aCIsIm1haW5DYW52YXNQYWRkaW5nIiwiYXR0ciIsIm9mZkNhbnZhcyIsImlzT2ZmQ2FudmFzIiwic2V0dGluZ3MiLCJpcyIsIm9wZW4iLCJhZGRDbGFzcyIsImRpYWxvZ0NsYXNzIiwiY2xvc2UiLCJyZW1vdmVDbGFzcyIsImRvY3VtZW50Iiwib2ZmIiwicmVuZGVyIiwiZXZlbnREYXRhIiwidG9nZ2xlQ2xhc3MiLCJ0aXRsZSIsIm9uIiwiZG9jdW1lbnRFbGVtZW50IiwiZGlyIiwiYmVoYXZpb3JzIiwib2ZmQ2FudmFzRXZlbnRzIiwiYXR0YWNoIiwib25jZSIsImpRdWVyeSJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQVNBLENBQUMsVUFBVUEsQ0FBVixFQUFhQyxNQUFiLEVBQXFCQyxRQUFyQixFQUErQkMsUUFBL0IsRUFBeUM7O0FBRXhDOztBQVFBLFdBQVNDLFNBQVQsQ0FBbUJDLEtBQW5CLEVBQTBCO0FBQ3hCLFFBQUlDLGtCQUFrQkQsTUFBTUUs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Q2tDLFFBQS9DLENBQUosRUFBOEQ7QUFDNUQxQyxtQkFBT3dDLFNBQVAsQ0FBaUJJLElBQWpCLENBQXNCeEMsS0FBdEIsRUFBNkJrQixNQUE3QixFQUFxQ2QsUUFBckMsRUFBK0NrQyxRQUEvQztBQUNEO0FBQ0YsU0FMNkI7QUFNOUIsOEJBQXNCLDJCQUFVdEMsS0FBVixFQUFpQmtCLE1BQWpCLEVBQXlCZCxRQUF6QixFQUFtQ2tDLFFBQW5DLEVBQTZDO0FBQ2pFLGNBQUkxQyxPQUFPd0MsU0FBUCxDQUFpQkMsV0FBakIsQ0FBNkJuQixNQUE3QixFQUFxQ2QsUUFBckMsRUFBK0NrQyxRQUEvQyxDQUFKLEVBQThEO0FBQzVEMUMsbUJBQU93QyxTQUFQLENBQWlCVyxNQUFqQixDQUF3Qi9DLEtBQXhCLEVBQStCa0IsTUFBL0IsRUFBdUNkLFFBQXZDLEVBQWlEa0MsUUFBakQ7QUFDRDtBQUNGLFNBVjZCO0FBVzlCLDhCQUFzQiwyQkFBVXRDLEtBQVYsRUFBaUJrQixNQUFqQixFQUF5QmQsUUFBekIsRUFBbUM7QUFDdkQsY0FBSVIsT0FBT3dDLFNBQVAsQ0FBaUJXLE1BQWpCLENBQXdCL0MsS0FBeEIsRUFBK0JrQixNQUEvQixFQUF1Q2QsUUFBdkMsRUFBaURrQyxRQUFqRCxDQUFKLEVBQWdFO0FBQzlEMUMsbUJBQU93QyxTQUFQLENBQWlCTyxLQUFqQixDQUF1QjNDLEtBQXZCLEVBQThCa0IsTUFBOUIsRUFBc0NkLFFBQXRDO0FBQ0Q7QUFDRjtBQWY2QixPQUFoQztBQWlCRDtBQW5CZ0MsR0FBbkM7QUFzQkQsQ0FwTEQsRUFvTEdzRCxNQXBMSCxFQW9MVzlELE1BcExYLEVBb0xtQkEsT0FBT0MsUUFwTDFCLEVBb0xvQ0QsT0FBT0UsUUFwTDNDIiwiZmlsZSI6Im9mZi1jYW52YXMuZXM2LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZmlsZVxuICogRHJ1cGFsJ3Mgb2ZmLWNhbnZhcyBsaWJyYXJ5LlxuICpcbiAqIEB0b2RvIFRoaXMgZnVuY3Rpb25hbGl0eSBzaG91bGQgZXh0cmFjdGVkIGludG8gYSBuZXcgY29yZSBsaWJyYXJ5IG9yIGEgcGFydFxuICogIG9mIHRoZSBjdXJyZW50IGRydXBhbC5kaWFsb2cuYWpheCBsaWJyYXJ5LlxuICogIGh0dHBzOi8vd3d3LmRydXBhbC5vcmcvbm9kZS8yNzg0NDQzXG4gKi9cblxuKGZ1bmN0aW9uICgkLCBEcnVwYWwsIGRlYm91bmNlLCBkaXNwbGFjZSkge1xuXG4gICd1c2Ugc3RyaWN0JztcblxuICAvKipcbiAgICogUmVzZXRzIHRoZSBzaXplIG9mIHRoZSBkaWFsb2cuXG4gICAqXG4gICAqIEBwYXJhbSB7alF1ZXJ5LkV2ZW50fSBldmVudFxuICAgKiAgIFRoZSBldmVudCB0cmlnZ2VyZWQuXG4gICAqL1xuICBmdW5jdGlvbiByZXNldFNpemUoZXZlbnQpIHtcbiAgICB2YXIgb2ZmQ2FudmFzRGlhbG9nID0gZXZlbnQuZGF0YS5vZmZDYW52YXNEaWFsb2c7XG4gICAgdmFyIG9mZnNldHMgPSBkaXNwbGFjZS5vZmZzZXRzO1xuICAgIHZhciAkZWxlbWVudCA9IGV2ZW50LmRhdGEuJGVsZW1lbnQ7XG4gICAgdmFyIGNvbnRhaW5lciA9IG9mZkNhbnZhc0RpYWxvZy5nZXRDb250YWluZXIoJGVsZW1lbnQpO1xuXG4gICAgdmFyIGFkanVzdGVkT3B0aW9ucyA9IHtcbiAgICAgIC8vIEBzZWUgaHR0cDovL2FwaS5qcXVlcnl1aS5jb20vcG9zaXRpb24vXG4gICAgICBwb3NpdGlvbjoge1xuICAgICAgICBteTogb2ZmQ2FudmFzRGlhbG9nLmdldEVkZ2UoKSArICcgdG9wJyxcbiAgICAgICAgYXQ6IG9mZkNhbnZhc0RpYWxvZy5nZXRFZGdlKCkgKyAnIHRvcCcgKyAob2Zmc2V0cy50b3AgIT09IDAgPyAnKycgKyBvZmZzZXRzLnRvcCA6ICcnKSxcbiAgICAgICAgb2Y6IHdpbmRvd1xuICAgICAgfVxuICAgIH07XG5cbiAgICBjb250YWluZXIuY3NzKHtcbiAgICAgIHBvc2l0aW9uOiAnZml4ZWQnLFxuICAgICAgaGVpZ2h0OiAoJCh3aW5kb3cpLmhlaWdodCgpIC0gKG9mZnNldHMudG9wICsgb2Zmc2V0cy5ib3R0b20pKSArICdweCdcbiAgICB9KTtcblxuICAgICRlbGVtZW50XG4gICAgICAgIC5kaWFsb2coJ29wdGlvbicsIGFkanVzdGVkT3B0aW9ucylcbiAgICAgICAgLnRyaWdnZXIoJ2RpYWxvZ0NvbnRlbnRSZXNpemUub2ZmLWNhbnZhcycpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkanVzdHMgdGhlIGRpYWxvZyBvbiByZXNpemUuXG4gICAqXG4gICAqIEBwYXJhbSB7alF1ZXJ5LkV2ZW50fSBldmVudFxuICAgKiAgIFRoZSBldmVudCB0cmlnZ2VyZWQuXG4gICAqL1xuICBmdW5jdGlvbiBoYW5kbGVEaWFsb2dSZXNpemUoZXZlbnQpIHtcbiAgICB2YXIgJGVsZW1lbnQgPSBldmVudC5kYXRhLiRlbGVtZW50O1xuICAgIHZhciBvZmZDYW52YXNEaWFsb2cgPSBldmVudC5kYXRhLm9mZkNhbnZhc0RpYWxvZztcbiAgICB2YXIgJGNvbnRhaW5lciA9IG9mZkNhbnZhc0RpYWxvZy5nZXRDb250YWluZXIoJGVsZW1lbnQpO1xuXG4gICAgdmFyICRvZmZzZXRzID0gJGNvbnRhaW5lci5maW5kKCc+IDpub3QoI2RydXBhbC1vZmYtY2FudmFzLCAudWktcmVzaXphYmxlLWhhbmRsZSknKTtcbiAgICB2YXIgb2Zmc2V0ID0gMDtcbiAgICB2YXIgbW9kYWxIZWlnaHQ7XG5cbiAgICAvLyBMZXQgc2Nyb2xsIGVsZW1lbnQgdGFrZSBhbGwgdGhlIGhlaWdodCBhdmFpbGFibGUuXG4gICAgJGVsZW1lbnQuY3NzKHtoZWlnaHQ6ICdhdXRvJ30pO1xuICAgIG1vZGFsSGVpZ2h0ID0gJGNvbnRhaW5lci5oZWlnaHQoKTtcbiAgICAkb2Zmc2V0cy5lYWNoKGZ1bmN0aW9uICgpIHsgb2Zmc2V0ICs9ICQodGhpcykub3V0ZXJIZWlnaHQoKTsgfSk7XG5cbiAgICAvLyBUYWtlIGludGVybmFsIHBhZGRpbmcgaW50byBhY2NvdW50LlxuICAgIHZhciBzY3JvbGxPZmZzZXQgPSAkZWxlbWVudC5vdXRlckhlaWdodCgpIC0gJGVsZW1lbnQuaGVpZ2h0KCk7XG4gICAgJGVsZW1lbnQuaGVpZ2h0KG1vZGFsSGVpZ2h0IC0gb2Zmc2V0IC0gc2Nyb2xsT2Zmc2V0KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGp1c3RzIHRoZSBib2R5IHBhZGRpbmcgd2hlbiB0aGUgZGlhbG9nIGlzIHJlc2l6ZWQuXG4gICAqXG4gICAqIEBwYXJhbSB7alF1ZXJ5LkV2ZW50fSBldmVudFxuICAgKiAgIFRoZSBldmVudCB0cmlnZ2VyZWQuXG4gICAqL1xuICBmdW5jdGlvbiBib2R5UGFkZGluZyhldmVudCkge1xuICAgIHZhciBvZmZDYW52YXNEaWFsb2cgPSBldmVudC5kYXRhLm9mZkNhbnZhc0RpYWxvZztcbiAgICBpZiAoJCgnYm9keScpLm91dGVyV2lkdGgoKSA8IG9mZkNhbnZhc0RpYWxvZy5taW5EaXNwbGFjZVdpZHRoKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciAkZWxlbWVudCA9IGV2ZW50LmRhdGEuJGVsZW1lbnQ7XG4gICAgdmFyICRjb250YWluZXIgPSBvZmZDYW52YXNEaWFsb2cuZ2V0Q29udGFpbmVyKCRlbGVtZW50KTtcbiAgICB2YXIgJG1haW5DYW52YXNXcmFwcGVyID0gb2ZmQ2FudmFzRGlhbG9nLiRtYWluQ2FudmFzV3JhcHBlcjtcblxuICAgIHZhciB3aWR0aCA9ICRjb250YWluZXIub3V0ZXJXaWR0aCgpO1xuICAgIHZhciBtYWluQ2FudmFzUGFkZGluZyA9ICRtYWluQ2FudmFzV3JhcHBlci5jc3MoJ3BhZGRpbmctJyArIG9mZkNhbnZhc0RpYWxvZy5nZXRFZGdlKCkpO1xuICAgIGlmICh3aWR0aCAhPT0gbWFpbkNhbnZhc1BhZGRpbmcpIHtcbiAgICAgICRtYWluQ2FudmFzV3JhcHBlci5jc3MoJ3BhZGRpbmctJyArIG9mZkNhbnZhc0RpYWxvZy5nZXRFZGdlKCksIHdpZHRoICsgJ3B4Jyk7XG4gICAgICAkY29udGFpbmVyLmF0dHIoJ2RhdGEtb2Zmc2V0LScgKyBvZmZDYW52YXNEaWFsb2cuZ2V0RWRnZSgpLCB3aWR0aCk7XG4gICAgICBkaXNwbGFjZSgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBBdHRhY2hlcyBvZmYtY2FudmFzIGRpYWxvZyBiZWhhdmlvcnMuXG4gICAqXG4gICAqIEB0eXBlIHtEcnVwYWx+YmVoYXZpb3J9XG4gICAqXG4gICAqIEBwcm9wIHtEcnVwYWx+YmVoYXZpb3JBdHRhY2h9IGF0dGFjaFxuICAgKiAgIEF0dGFjaGVzIGV2ZW50IGxpc3RlbmVycyBmb3Igb2ZmLWNhbnZhcyBkaWFsb2dzLlxuICAgKi9cblxuICBEcnVwYWwub2ZmQ2FudmFzID0ge1xuICAgIC8vIFRoZSBtaW5pbXVtIHdpZHRoIHRvIHVzZSBib2R5IGRpc3BsYWNlIG5lZWRzIHRvIG1hdGNoIHRoZSB3aWR0aCBhdCB3aGljaFxuICAgIC8vIHRoZSB0cmF5IHdpbGwgYmUgJTEwMCB3aWR0aC4gQHNlZSBvdXRzaWRlX2luLm1vZHVsZS5jc3NcbiAgICBtaW5EaXNwbGFjZVdpZHRoOiA3NjgsXG5cbiAgICAkbWFpbkNhbnZhc1dyYXBwZXI6ICQoJ1tkYXRhLW9mZi1jYW52YXMtbWFpbi1jYW52YXNdJyksXG4gICAgLyoqXG4gICAgICogRGV0ZXJtaW5lcyBpZiBhXG4gICAgICogQHJldHVybiB7Ym9vbH1cbiAgICAgKi9cbiAgICBpc09mZkNhbnZhczogZnVuY3Rpb24gKGRpYWxvZywgJGVsZW1lbnQsIHNldHRpbmdzKSB7XG4gICAgICByZXR1cm4gJGVsZW1lbnQuaXMoJyNkcnVwYWwtb2ZmLWNhbnZhcycpO1xuICAgIH0sXG4gICAgb3BlbjogZnVuY3Rpb24gKGV2ZW50LCBkaWFsb2csICRlbGVtZW50LCBzZXR0aW5ncykge1xuICAgICAgJCgnYm9keScpLmFkZENsYXNzKCdqcy10cmF5LW9wZW4nKTtcbiAgICAgIHNldHRpbmdzLmRpYWxvZ0NsYXNzICs9ICcgdWktZGlhbG9nLW9mZi1jYW52YXMnO1xuICAgICAgLy8gQHNlZSBodHRwOi8vYXBpLmpxdWVyeXVpLmNvbS9wb3NpdGlvbi9cbiAgICAgIHNldHRpbmdzLnBvc2l0aW9uID0ge1xuICAgICAgICBteTogJ2xlZnQgdG9wJyxcbiAgICAgICAgYXQ6IHRoaXMuZ2V0RWRnZSgpICsgJyB0b3AnLFxuICAgICAgICBvZjogd2luZG93XG4gICAgICB9O1xuICAgICAgLy8gQXBwbGllcyBpbml0aWFsIGhlaWdodCB0byBkaWFsb2cgYmFzZWQgb24gd2luZG93IGhlaWdodC5cbiAgICAgIC8vIFNlZSBodHRwOi8vYXBpLmpxdWVyeXVpLmNvbS9kaWFsb2cgZm9yIGFsbCBkaWFsb2cgb3B0aW9ucy5cbiAgICAgIHNldHRpbmdzLmhlaWdodCA9ICQod2luZG93KS5oZWlnaHQoKTtcbiAgICB9LFxuICAgIGNsb3NlOiBmdW5jdGlvbiAoZXZlbnQsIGRpYWxvZywgJGVsZW1lbnQpIHtcbiAgICAgICQoJ2JvZHknKS5yZW1vdmVDbGFzcygnanMtdHJheS1vcGVuJyk7XG4gICAgICAvLyBSZW1vdmUgYWxsICoub2ZmLWNhbnZhcyBldmVudHNcbiAgICAgICQoZG9jdW1lbnQpLm9mZignLm9mZi1jYW52YXMnKTtcbiAgICAgICQod2luZG93KS5vZmYoJy5vZmYtY2FudmFzJyk7XG4gICAgICB0aGlzLiRtYWluQ2FudmFzV3JhcHBlci5jc3MoJ3BhZGRpbmctJyArIHRoaXMuZ2V0RWRnZSgpLCAwKTtcbiAgICB9LFxuICAgIHJlbmRlcjogZnVuY3Rpb24gKGV2ZW50LCBkaWFsb2csICRlbGVtZW50LCBzZXR0aW5ncykge1xuICAgICAgdmFyIGV2ZW50RGF0YSA9IHtzZXR0aW5nczogc2V0dGluZ3MsICRlbGVtZW50OiAkZWxlbWVudCwgb2ZmQ2FudmFzRGlhbG9nOiB0aGlzfTtcbiAgICAgICQoJy51aS1kaWFsb2ctb2ZmLWNhbnZhcywgLnVpLWRpYWxvZy1vZmYtY2FudmFzIC51aS1kaWFsb2ctdGl0bGViYXInKS50b2dnbGVDbGFzcygndWktZGlhbG9nLWVtcHR5LXRpdGxlJywgIXNldHRpbmdzLnRpdGxlKTtcblxuICAgICAgJGVsZW1lbnRcbiAgICAgICAgICAub24oJ2RpYWxvZ3Jlc2l6ZS5vZmYtY2FudmFzJywgZXZlbnREYXRhLCBkZWJvdW5jZShib2R5UGFkZGluZywgMTAwKSlcbiAgICAgICAgICAub24oJ2RpYWxvZ0NvbnRlbnRSZXNpemUub2ZmLWNhbnZhcycsIGV2ZW50RGF0YSwgaGFuZGxlRGlhbG9nUmVzaXplKVxuICAgICAgICAgIC5vbignZGlhbG9nQ29udGVudFJlc2l6ZS5vZmYtY2FudmFzJywgZXZlbnREYXRhLCBkZWJvdW5jZShib2R5UGFkZGluZywgMTAwKSlcbiAgICAgICAgICAudHJpZ2dlcignZGlhbG9ncmVzaXplLm9mZi1jYW52YXMnKTtcblxuICAgICAgdGhpcy5nZXRDb250YWluZXIoJGVsZW1lbnQpLmF0dHIoJ2RhdGEtb2Zmc2V0LScgKyB0aGlzLmdldEVkZ2UoKSwgJycpO1xuXG4gICAgICAkKHdpbmRvdylcbiAgICAgICAgICAub24oJ3Jlc2l6ZS5vZmYtY2FudmFzIHNjcm9sbC5vZmYtY2FudmFzJywgZXZlbnREYXRhLCBkZWJvdW5jZShyZXNldFNpemUsIDEwMCkpXG4gICAgICAgICAgLnRyaWdnZXIoJ3Jlc2l6ZS5vZmYtY2FudmFzJyk7XG4gICAgfSxcbiAgICBoYW5kbGVEaWFsb2dSZXNpemU6IGhhbmRsZURpYWxvZ1Jlc2l6ZSxcbiAgICByZXNldFNpemU6IHJlc2V0U2l6ZSxcbiAgICBib2R5UGFkZGluZzogYm9keVBhZGRpbmcsXG4gICAgZ2V0Q29udGFpbmVyOiBmdW5jdGlvbiAoJGVsZW1lbnQpIHtcbiAgICAgIHJldHVybiAkZWxlbWVudC5kaWFsb2coJ3dpZGdldCcpO1xuICAgIH0sXG4gICAgLyoqXG4gICAgICogVGhlIGVkZ2Ugb2YgdGhlIHNjcmVlbiB0aGF0IHRoZSBkaWFsb2cgc2hvdWxkIGFwcGVhciBvbi5cbiAgICAgKlxuICAgICAqIEByZXR1cm4ge3N0cmluZ31cbiAgICAgKi9cbiAgICBnZXRFZGdlOiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmRpciA9PT0gJ3J0bCcgPyAnbGVmdCcgOiAncmlnaHQnO1xuICAgIH1cbiAgfTtcblxuICBEcnVwYWwuYmVoYXZpb3JzLm9mZkNhbnZhc0V2ZW50cyA9IHtcbiAgICBhdHRhY2g6IGZ1bmN0aW9uICgpIHtcbiAgICAgICQod2luZG93KS5vbmNlKCdvZmYtY2FudmFzJykub24oe1xuICAgICAgICAnZGlhbG9nOmJlZm9yZWNyZWF0ZSc6IGZ1bmN0aW9uIChldmVudCwgZGlhbG9nLCAkZWxlbWVudCwgc2V0dGluZ3MpIHtcbiAgICAgICAgICBpZiAoRHJ1cGFsLm9mZkNhbnZhcy5pc09mZkNhbnZhcyhkaWFsb2csICRlbGVtZW50LCBzZXR0aW5ncykpIHtcbiAgICAgICAgICAgIERydXBhbC5vZmZDYW52YXMub3BlbihldmVudCwgZGlhbG9nLCAkZWxlbWVudCwgc2V0dGluZ3MpXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICAnZGlhbG9nOmFmdGVyY3JlYXRlJzogZnVuY3Rpb24gKGV2ZW50LCBkaWFsb2csICRlbGVtZW50LCBzZXR0aW5ncykge1xuICAgICAgICAgIGlmIChEcnVwYWwub2ZmQ2FudmFzLmlzT2ZmQ2FudmFzKGRpYWxvZywgJGVsZW1lbnQsIHNldHRpbmdzKSkge1xuICAgICAgICAgICAgRHJ1cGFsLm9mZkNhbnZhcy5yZW5kZXIoZXZlbnQsIGRpYWxvZywgJGVsZW1lbnQsIHNldHRpbmdzKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgICdkaWFsb2c6YmVmb3JlY2xvc2UnOiBmdW5jdGlvbiAoZXZlbnQsIGRpYWxvZywgJGVsZW1lbnQpIHtcbiAgICAgICAgICBpZiAoRHJ1cGFsLm9mZkNhbnZhcy5yZW5kZXIoZXZlbnQsIGRpYWxvZywgJGVsZW1lbnQsIHNldHRpbmdzKSkge1xuICAgICAgICAgICAgRHJ1cGFsLm9mZkNhbnZhcy5jbG9zZShldmVudCwgZGlhbG9nLCAkZWxlbWVudClcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfTtcblxufSkoalF1ZXJ5LCBEcnVwYWwsIERydXBhbC5kZWJvdW5jZSwgRHJ1cGFsLmRpc3BsYWNlKTtcbiJdfQ==