/**
* DO NOT EDIT THIS FILE.
* See the following change record for more information,
* https://www.drupal.org/node/2815083
* @preserve
**/

(function ($, Drupal, debounce, displace) {

  'use strict';

  function resetSize(event) {
    var offCanvasDialog = event.data.offCanvasDialog;
    var offsets = displace.offsets;
    var $element = event.data.$element;
    var $widget = offCanvasDialog.getContainer($element);

    var adjustedOptions = {
      position: {
        my: offCanvasDialog.edge + ' top',
        at: offCanvasDialog.edge + ' top' + (offsets.top !== 0 ? '+' + offsets.top : ''),
        of: window
      }
    };

    $widget.css({
      position: 'fixed',
      height: $(window).height() - (offsets.top + offsets.bottom) + 'px'
    });

    $element.dialog('option', adjustedOptions).trigger('dialogContentResize.off-canvas');
  }

  function handleDialogResize(event) {
    var $element = event.data.$element;
    var offCanvasDialog = event.data.offCanvasDialog;
    var $container = offCanvasDialog.getContainer($element);

    var $offsets = $container.find('> :not(#drupal-off-canvas, .ui-resizable-handle)');
    var offset = 0;
    var modalHeight;

    $element.css({ height: 'auto' });
    modalHeight = $container.height();
    $offsets.each(function () {
      offset += $(this).outerHeight();
    });

    var scrollOffset = $element.outerHeight() - $element.height();
    $element.height(modalHeight - offset - scrollOffset);
  }

  function bodyPadding(event) {
    var offCanvasDialog = event.data.offCanvasDialog;
    if ($('body').outerWidth() < offCanvasDialog.minDisplaceWidth) {
      return;
    }
    var $element = event.data.$element;
    var $container = offCanvasDialog.getContainer($element);
    var $mainCanvasWrapper = offCanvasDialog.$mainCanvasWrapper;

    var width = $container.outerWidth();
    var mainCanvasPadding = $mainCanvasWrapper.css('padding-' + offCanvasDialog.edge);
    if (width !== mainCanvasPadding) {
      $mainCanvasWrapper.css('padding-' + offCanvasDialog.edge, width + 'px');
      $container.attr('data-offset-' + offCanvasDialog.edge, width);
      displace();
    }
  }

  Drupal.offCanvas = {
    minDisplaceWidth: 768,

    edge: document.documentElement.dir === 'rtl' ? 'left' : 'right',

    $mainCanvasWrapper: $('[data-off-canvas-main-canvas]'),
    open: function open(event, dialog, $element, settings) {
      $('body').addClass('js-tray-open');

      settings.position = {
        my: 'left top',
        at: this.edge + ' top',
        of: window
      };
      settings.dialogClass += ' ui-dialog-off-canvas';

      settings.height = $(window).height();
    },
    close: function close(event, dialog, $element) {
      $('body').removeClass('js-tray-open');

      $(document).off('.off-canvas');
      $(window).off('.off-canvas');
      this.$mainCanvasWrapper.css('padding-' + this.edge, 0);
    },
    render: function render(event, dialog, $element, settings) {
      var eventData = { settings: settings, $element: $element, offCanvasDialog: this };
      $('.ui-dialog-off-canvas, .ui-dialog-off-canvas .ui-dialog-titlebar').toggleClass('ui-dialog-empty-title', !settings.title);

      $element.on('dialogresize.off-canvas', eventData, debounce(bodyPadding, 100)).on('dialogContentResize.off-canvas', eventData, handleDialogResize).on('dialogContentResize.off-canvas', eventData, debounce(bodyPadding, 100)).trigger('dialogresize.off-canvas');

      this.getContainer($element).attr('data-offset-' + this.edge, '');

      $(window).on('resize.off-canvas scroll.off-canvas', eventData, debounce(resetSize, 100)).trigger('resize.off-canvas');
    },
    handleDialogResize: handleDialogResize,
    resetSize: resetSize,
    bodyPadding: bodyPadding,
    getContainer: function getContainer($element) {
      return $element.dialog('widget');
    }
  };

  Drupal.behaviors.offCanvasEvents = {
    attach: function attach() {
      $(window).once('off-canvas').on({
        'dialog:aftercreate': function dialogAftercreate(event, dialog, $element, settings) {
          Drupal.offCanvas.render(event, dialog, $element, settings);
        },
        'dialog:beforecreate': function dialogBeforecreate(event, dialog, $element, settings) {
          Drupal.offCanvas.open(event, dialog, $element, settings);
        },
        'dialog:beforeclose': function dialogBeforeclose(event, dialog, $element) {
          Drupal.offCanvas.close(event, dialog, $element);
        }
      });
    }
  };
})(jQuery, Drupal, Drupal.debounce, Drupal.displace);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm9mZi1jYW52YXMuZXM2LmpzIl0sIm5hbWVzIjpbIiQiLCJEcnVwYWwiLCJkZWJvdW5jZSIsImRpc3BsYWNlIiwicmVzZXRTaXplIiwiZXZlbnQiLCJvZmZDYW52YXNEaWFsb2ciLCJkYXRhIiwib2Zmc2V0cyIsIiRlbGVtZW50IiwiJHdpZGdldCIsImdldENvbnRhaW5lciIsImFkanVzdGVkT3B0aW9ucyIsInBvc2l0aW9uIiwibXkiLCJlZGdlIiwiYXQiLCJ0b3AiLCJvZiIsIndpbmRvdyIsImNzcyIsImhlaWdodCIsImJvdHRvbSIsImRpYWxvZyIsInRyaWdnZXIiLCJoYW5kbGVEaWFsb2dSZXNpemUiLCIkY29udGFpbmVyIiwiJG9mZnNldHMiLCJmaW5kIiwib2Zmc2V0IiwibW9kYWxIZWlnaHQiLCJlYWNoIiwib3V0ZXJIZWlnaHQiLCJzY3JvbGxPZmZzZXQiLCJib2R5UGFkZGluZyIsIm91dGVyV2lkdGgiLCJtaW5EaXNwbGFjZVdpZHRoIiwiJG1haW5DYW52YXNXcmFwcGVyIiwid2lkdGgiLCJtYWluQ2FudmFzUGFkZGluZyIsImF0dHIiLCJvZmZDYW52YXMiLCJkb2N1bWVudCIsImRvY3VtZW50RWxlbWVudCIsImRpciIsIm9wZW4iLCJzZXR0aW5ncyIsImFkZENsYXNzIiwiZGlhbG9nQ2xhc3MiLCJjbG9zZSIsInJlbW92ZUNsYXNzIiwib2ZmIiwicmVuZGVyIiwiZXZlbnREYXRhIiwidG9nZ2xlQ2xhc3MiLCJ0aXRsZSIsIm9uIiwiYmVoYXZpb3JzIiwib2ZmQ2FudmFzRXZlbnRzIiwiYXR0YWNoIiwib25jZSIsImpRdWVyeSJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQVNBLENBQUMsVUFBVUEsQ0FBVixFQUFhQyxNQUFiLEVBQXFCQyxRQUFyQixFQUErQkMsUUFBL0IsRUFBeUM7O0FBRXhDOztBQVFBLFdBQVNDLFNBQVQsQ0FBbUJDLEtBQW5CLEVBQTBCO0FBQ3hCLFFBQUlDLGtCQUFrQkQsTUFBTUUsSUFBTixDQUFXRCxlQUFqQztBQUNBLFFB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Q0QsU0FONkI7QUFPOUIsOEJBQXNCLDJCQUFVekMsS0FBVixFQUFpQmtCLE1BQWpCLEVBQXlCZCxRQUF6QixFQUFtQztBQUN2RFIsaUJBQU93QyxTQUFQLENBQWlCUSxLQUFqQixDQUF1QjVDLEtBQXZCLEVBQThCa0IsTUFBOUIsRUFBc0NkLFFBQXRDO0FBQ0Q7QUFUNkIsT0FBaEM7QUFXRDtBQWJnQyxHQUFuQztBQWdCRCxDQXRLRCxFQXNLR29ELE1BdEtILEVBc0tXNUQsTUF0S1gsRUFzS21CQSxPQUFPQyxRQXRLMUIsRUFzS29DRCxPQUFPRSxRQXRLM0MiLCJmaWxlIjoib2ZmLWNhbnZhcy5lczYuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBmaWxlXG4gKiBEcnVwYWwncyBvZmYtY2FudmFzIGxpYnJhcnkuXG4gKlxuICogQHRvZG8gVGhpcyBmdW5jdGlvbmFsaXR5IHNob3VsZCBleHRyYWN0ZWQgaW50byBhIG5ldyBjb3JlIGxpYnJhcnkgb3IgYSBwYXJ0XG4gKiAgb2YgdGhlIGN1cnJlbnQgZHJ1cGFsLmRpYWxvZy5hamF4IGxpYnJhcnkuXG4gKiAgaHR0cHM6Ly93d3cuZHJ1cGFsLm9yZy9ub2RlLzI3ODQ0NDNcbiAqL1xuXG4oZnVuY3Rpb24gKCQsIERydXBhbCwgZGVib3VuY2UsIGRpc3BsYWNlKSB7XG5cbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIC8qKlxuICAgKiBSZXNldHMgdGhlIHNpemUgb2YgdGhlIGRpYWxvZy5cbiAgICpcbiAgICogQHBhcmFtIHtqUXVlcnkuRXZlbnR9IGV2ZW50XG4gICAqICAgVGhlIGV2ZW50IHRyaWdnZXJlZC5cbiAgICovXG4gIGZ1bmN0aW9uIHJlc2V0U2l6ZShldmVudCkge1xuICAgIHZhciBvZmZDYW52YXNEaWFsb2cgPSBldmVudC5kYXRhLm9mZkNhbnZhc0RpYWxvZztcbiAgICB2YXIgb2Zmc2V0cyA9IGRpc3BsYWNlLm9mZnNldHM7XG4gICAgdmFyICRlbGVtZW50ID0gZXZlbnQuZGF0YS4kZWxlbWVudDtcbiAgICB2YXIgJHdpZGdldCA9IG9mZkNhbnZhc0RpYWxvZy5nZXRDb250YWluZXIoJGVsZW1lbnQpO1xuXG4gICAgdmFyIGFkanVzdGVkT3B0aW9ucyA9IHtcbiAgICAgIC8vIEBzZWUgaHR0cDovL2FwaS5qcXVlcnl1aS5jb20vcG9zaXRpb24vXG4gICAgICBwb3NpdGlvbjoge1xuICAgICAgICBteTogb2ZmQ2FudmFzRGlhbG9nLmVkZ2UgKyAnIHRvcCcsXG4gICAgICAgIGF0OiBvZmZDYW52YXNEaWFsb2cuZWRnZSArICcgdG9wJyArIChvZmZzZXRzLnRvcCAhPT0gMCA/ICcrJyArIG9mZnNldHMudG9wIDogJycpLFxuICAgICAgICBvZjogd2luZG93XG4gICAgICB9XG4gICAgfTtcblxuICAgICR3aWRnZXQuY3NzKHtcbiAgICAgIHBvc2l0aW9uOiAnZml4ZWQnLFxuICAgICAgaGVpZ2h0OiAoJCh3aW5kb3cpLmhlaWdodCgpIC0gKG9mZnNldHMudG9wICsgb2Zmc2V0cy5ib3R0b20pKSArICdweCdcbiAgICB9KTtcblxuICAgICRlbGVtZW50XG4gICAgICAgIC5kaWFsb2coJ29wdGlvbicsIGFkanVzdGVkT3B0aW9ucylcbiAgICAgICAgLnRyaWdnZXIoJ2RpYWxvZ0NvbnRlbnRSZXNpemUub2ZmLWNhbnZhcycpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkanVzdHMgdGhlIGRpYWxvZyBvbiByZXNpemUuXG4gICAqXG4gICAqIEBwYXJhbSB7alF1ZXJ5LkV2ZW50fSBldmVudFxuICAgKiAgIFRoZSBldmVudCB0cmlnZ2VyZWQuXG4gICAqL1xuICBmdW5jdGlvbiBoYW5kbGVEaWFsb2dSZXNpemUoZXZlbnQpIHtcbiAgICB2YXIgJGVsZW1lbnQgPSBldmVudC5kYXRhLiRlbGVtZW50O1xuICAgIHZhciBvZmZDYW52YXNEaWFsb2cgPSBldmVudC5kYXRhLm9mZkNhbnZhc0RpYWxvZztcbiAgICB2YXIgJGNvbnRhaW5lciA9IG9mZkNhbnZhc0RpYWxvZy5nZXRDb250YWluZXIoJGVsZW1lbnQpO1xuXG4gICAgdmFyICRvZmZzZXRzID0gJGNvbnRhaW5lci5maW5kKCc+IDpub3QoI2RydXBhbC1vZmYtY2FudmFzLCAudWktcmVzaXphYmxlLWhhbmRsZSknKTtcbiAgICB2YXIgb2Zmc2V0ID0gMDtcbiAgICB2YXIgbW9kYWxIZWlnaHQ7XG5cbiAgICAvLyBMZXQgc2Nyb2xsIGVsZW1lbnQgdGFrZSBhbGwgdGhlIGhlaWdodCBhdmFpbGFibGUuXG4gICAgJGVsZW1lbnQuY3NzKHtoZWlnaHQ6ICdhdXRvJ30pO1xuICAgIG1vZGFsSGVpZ2h0ID0gJGNvbnRhaW5lci5oZWlnaHQoKTtcbiAgICAkb2Zmc2V0cy5lYWNoKGZ1bmN0aW9uICgpIHsgb2Zmc2V0ICs9ICQodGhpcykub3V0ZXJIZWlnaHQoKTsgfSk7XG5cbiAgICAvLyBUYWtlIGludGVybmFsIHBhZGRpbmcgaW50byBhY2NvdW50LlxuICAgIHZhciBzY3JvbGxPZmZzZXQgPSAkZWxlbWVudC5vdXRlckhlaWdodCgpIC0gJGVsZW1lbnQuaGVpZ2h0KCk7XG4gICAgJGVsZW1lbnQuaGVpZ2h0KG1vZGFsSGVpZ2h0IC0gb2Zmc2V0IC0gc2Nyb2xsT2Zmc2V0KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGp1c3RzIHRoZSBib2R5IHBhZGRpbmcgd2hlbiB0aGUgZGlhbG9nIGlzIHJlc2l6ZWQuXG4gICAqXG4gICAqIEBwYXJhbSB7alF1ZXJ5LkV2ZW50fSBldmVudFxuICAgKiAgIFRoZSBldmVudCB0cmlnZ2VyZWQuXG4gICAqL1xuICBmdW5jdGlvbiBib2R5UGFkZGluZyhldmVudCkge1xuICAgIHZhciBvZmZDYW52YXNEaWFsb2cgPSBldmVudC5kYXRhLm9mZkNhbnZhc0RpYWxvZztcbiAgICBpZiAoJCgnYm9keScpLm91dGVyV2lkdGgoKSA8IG9mZkNhbnZhc0RpYWxvZy5taW5EaXNwbGFjZVdpZHRoKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciAkZWxlbWVudCA9IGV2ZW50LmRhdGEuJGVsZW1lbnQ7XG4gICAgdmFyICRjb250YWluZXIgPSBvZmZDYW52YXNEaWFsb2cuZ2V0Q29udGFpbmVyKCRlbGVtZW50KTtcbiAgICB2YXIgJG1haW5DYW52YXNXcmFwcGVyID0gb2ZmQ2FudmFzRGlhbG9nLiRtYWluQ2FudmFzV3JhcHBlcjtcblxuICAgIHZhciB3aWR0aCA9ICRjb250YWluZXIub3V0ZXJXaWR0aCgpO1xuICAgIHZhciBtYWluQ2FudmFzUGFkZGluZyA9ICRtYWluQ2FudmFzV3JhcHBlci5jc3MoJ3BhZGRpbmctJyArIG9mZkNhbnZhc0RpYWxvZy5lZGdlKTtcbiAgICBpZiAod2lkdGggIT09IG1haW5DYW52YXNQYWRkaW5nKSB7XG4gICAgICAkbWFpbkNhbnZhc1dyYXBwZXIuY3NzKCdwYWRkaW5nLScgKyBvZmZDYW52YXNEaWFsb2cuZWRnZSwgd2lkdGggKyAncHgnKTtcbiAgICAgICRjb250YWluZXIuYXR0cignZGF0YS1vZmZzZXQtJyArIG9mZkNhbnZhc0RpYWxvZy5lZGdlLCB3aWR0aCk7XG4gICAgICBkaXNwbGFjZSgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBBdHRhY2hlcyBvZmYtY2FudmFzIGRpYWxvZyBiZWhhdmlvcnMuXG4gICAqXG4gICAqIEB0eXBlIHtEcnVwYWx+YmVoYXZpb3J9XG4gICAqXG4gICAqIEBwcm9wIHtEcnVwYWx+YmVoYXZpb3JBdHRhY2h9IGF0dGFjaFxuICAgKiAgIEF0dGFjaGVzIGV2ZW50IGxpc3RlbmVycyBmb3Igb2ZmLWNhbnZhcyBkaWFsb2dzLlxuICAgKi9cblxuICBEcnVwYWwub2ZmQ2FudmFzID0ge1xuICAgIC8vIFRoZSBtaW5pbXVtIHdpZHRoIHRvIHVzZSBib2R5IGRpc3BsYWNlIG5lZWRzIHRvIG1hdGNoIHRoZSB3aWR0aCBhdCB3aGljaFxuICAgIC8vIHRoZSB0cmF5IHdpbGwgYmUgJTEwMCB3aWR0aC4gQHNlZSBvdXRzaWRlX2luLm1vZHVsZS5jc3NcbiAgICBtaW5EaXNwbGFjZVdpZHRoOiA3NjgsXG5cbiAgICAvKipcbiAgICAgKiBUaGUgZWRnZSBvZiB0aGUgc2NyZWVuIHRoYXQgdGhlIGRpYWxvZyBzaG91bGQgYXBwZWFyIG9uLlxuICAgICAqXG4gICAgICogQHR5cGUge3N0cmluZ31cbiAgICAgKi9cbiAgICBlZGdlOiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuZGlyID09PSAncnRsJyA/ICdsZWZ0JyA6ICdyaWdodCcsXG5cbiAgICAkbWFpbkNhbnZhc1dyYXBwZXI6ICQoJ1tkYXRhLW9mZi1jYW52YXMtbWFpbi1jYW52YXNdJyksXG4gICAgb3BlbjogZnVuY3Rpb24gKGV2ZW50LCBkaWFsb2csICRlbGVtZW50LCBzZXR0aW5ncykge1xuICAgICAgJCgnYm9keScpLmFkZENsYXNzKCdqcy10cmF5LW9wZW4nKTtcbiAgICAgIC8vIEBzZWUgaHR0cDovL2FwaS5qcXVlcnl1aS5jb20vcG9zaXRpb24vXG4gICAgICBzZXR0aW5ncy5wb3NpdGlvbiA9IHtcbiAgICAgICAgbXk6ICdsZWZ0IHRvcCcsXG4gICAgICAgIGF0OiB0aGlzLmVkZ2UgKyAnIHRvcCcsXG4gICAgICAgIG9mOiB3aW5kb3dcbiAgICAgIH07XG4gICAgICBzZXR0aW5ncy5kaWFsb2dDbGFzcyArPSAnIHVpLWRpYWxvZy1vZmYtY2FudmFzJztcbiAgICAgIC8vIEFwcGxpZXMgaW5pdGlhbCBoZWlnaHQgdG8gZGlhbG9nIGJhc2VkIG9uIHdpbmRvdyBoZWlnaHQuXG4gICAgICAvLyBTZWUgaHR0cDovL2FwaS5qcXVlcnl1aS5jb20vZGlhbG9nIGZvciBhbGwgZGlhbG9nIG9wdGlvbnMuXG4gICAgICBzZXR0aW5ncy5oZWlnaHQgPSAkKHdpbmRvdykuaGVpZ2h0KCk7XG4gICAgfSxcbiAgICBjbG9zZTogZnVuY3Rpb24gKGV2ZW50LCBkaWFsb2csICRlbGVtZW50KSB7XG4gICAgICAkKCdib2R5JykucmVtb3ZlQ2xhc3MoJ2pzLXRyYXktb3BlbicpO1xuICAgICAgLy8gUmVtb3ZlIGFsbCAqLm9mZi1jYW52YXMgZXZlbnRzXG4gICAgICAkKGRvY3VtZW50KS5vZmYoJy5vZmYtY2FudmFzJyk7XG4gICAgICAkKHdpbmRvdykub2ZmKCcub2ZmLWNhbnZhcycpO1xuICAgICAgdGhpcy4kbWFpbkNhbnZhc1dyYXBwZXIuY3NzKCdwYWRkaW5nLScgKyB0aGlzLmVkZ2UsIDApO1xuICAgIH0sXG4gICAgcmVuZGVyOiBmdW5jdGlvbiAoZXZlbnQsIGRpYWxvZywgJGVsZW1lbnQsIHNldHRpbmdzKSB7XG4gICAgICB2YXIgZXZlbnREYXRhID0ge3NldHRpbmdzOiBzZXR0aW5ncywgJGVsZW1lbnQ6ICRlbGVtZW50LCBvZmZDYW52YXNEaWFsb2c6IHRoaXN9O1xuICAgICAgJCgnLnVpLWRpYWxvZy1vZmYtY2FudmFzLCAudWktZGlhbG9nLW9mZi1jYW52YXMgLnVpLWRpYWxvZy10aXRsZWJhcicpLnRvZ2dsZUNsYXNzKCd1aS1kaWFsb2ctZW1wdHktdGl0bGUnLCAhc2V0dGluZ3MudGl0bGUpO1xuXG4gICAgICAkZWxlbWVudFxuICAgICAgICAgIC5vbignZGlhbG9ncmVzaXplLm9mZi1jYW52YXMnLCBldmVudERhdGEsIGRlYm91bmNlKGJvZHlQYWRkaW5nLCAxMDApKVxuICAgICAgICAgIC5vbignZGlhbG9nQ29udGVudFJlc2l6ZS5vZmYtY2FudmFzJywgZXZlbnREYXRhLCBoYW5kbGVEaWFsb2dSZXNpemUpXG4gICAgICAgICAgLm9uKCdkaWFsb2dDb250ZW50UmVzaXplLm9mZi1jYW52YXMnLCBldmVudERhdGEsIGRlYm91bmNlKGJvZHlQYWRkaW5nLCAxMDApKVxuICAgICAgICAgIC50cmlnZ2VyKCdkaWFsb2dyZXNpemUub2ZmLWNhbnZhcycpO1xuXG4gICAgICB0aGlzLmdldENvbnRhaW5lcigkZWxlbWVudCkuYXR0cignZGF0YS1vZmZzZXQtJyArIHRoaXMuZWRnZSwgJycpO1xuXG4gICAgICAkKHdpbmRvdylcbiAgICAgICAgICAub24oJ3Jlc2l6ZS5vZmYtY2FudmFzIHNjcm9sbC5vZmYtY2FudmFzJywgZXZlbnREYXRhLCBkZWJvdW5jZShyZXNldFNpemUsIDEwMCkpXG4gICAgICAgICAgLnRyaWdnZXIoJ3Jlc2l6ZS5vZmYtY2FudmFzJyk7XG4gICAgfSxcbiAgICBoYW5kbGVEaWFsb2dSZXNpemU6IGhhbmRsZURpYWxvZ1Jlc2l6ZSxcbiAgICByZXNldFNpemU6IHJlc2V0U2l6ZSxcbiAgICBib2R5UGFkZGluZzogYm9keVBhZGRpbmcsXG4gICAgZ2V0Q29udGFpbmVyOiBmdW5jdGlvbiAoJGVsZW1lbnQpIHtcbiAgICAgIHJldHVybiAkZWxlbWVudC5kaWFsb2coJ3dpZGdldCcpO1xuICAgIH1cbiAgfTtcblxuICBEcnVwYWwuYmVoYXZpb3JzLm9mZkNhbnZhc0V2ZW50cyA9IHtcbiAgICBhdHRhY2g6IGZ1bmN0aW9uICgpIHtcbiAgICAgICQod2luZG93KS5vbmNlKCdvZmYtY2FudmFzJykub24oe1xuICAgICAgICAnZGlhbG9nOmFmdGVyY3JlYXRlJzogZnVuY3Rpb24gKGV2ZW50LCBkaWFsb2csICRlbGVtZW50LCBzZXR0aW5ncykge1xuICAgICAgICAgIERydXBhbC5vZmZDYW52YXMucmVuZGVyKGV2ZW50LCBkaWFsb2csICRlbGVtZW50LCBzZXR0aW5ncylcbiAgICAgICAgfSxcbiAgICAgICAgJ2RpYWxvZzpiZWZvcmVjcmVhdGUnOiBmdW5jdGlvbiAoZXZlbnQsIGRpYWxvZywgJGVsZW1lbnQsIHNldHRpbmdzKSB7XG4gICAgICAgICAgRHJ1cGFsLm9mZkNhbnZhcy5vcGVuKGV2ZW50LCBkaWFsb2csICRlbGVtZW50LCBzZXR0aW5ncylcbiAgICAgICAgfSxcbiAgICAgICAgJ2RpYWxvZzpiZWZvcmVjbG9zZSc6IGZ1bmN0aW9uIChldmVudCwgZGlhbG9nLCAkZWxlbWVudCkge1xuICAgICAgICAgIERydXBhbC5vZmZDYW52YXMuY2xvc2UoZXZlbnQsIGRpYWxvZywgJGVsZW1lbnQpXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfTtcblxufSkoalF1ZXJ5LCBEcnVwYWwsIERydXBhbC5kZWJvdW5jZSwgRHJ1cGFsLmRpc3BsYWNlKTtcbiJdfQ==