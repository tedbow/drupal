/**
* DO NOT EDIT THIS FILE.
* See the following change record for more information,
* https://www.drupal.org/node/2815083
* @preserve
**/

(function ($, Drupal, drupalSettings, _, Backbone, JSON, storage) {
  var options = $.extend(drupalSettings.contextual, {
    strings: {
      open: Drupal.t('Open'),
      close: Drupal.t('Close')
    }
  });

  var cachedPermissionsHash = storage.getItem('Drupal.contextual.permissionsHash');
  var permissionsHash = drupalSettings.user.permissionsHash;
  if (cachedPermissionsHash !== permissionsHash) {
    if (typeof permissionsHash === 'string') {
      _.chain(storage).keys().each(function (key) {
        if (key.substring(0, 18) === 'Drupal.contextual.') {
          storage.removeItem(key);
        }
      });
    }
    storage.setItem('Drupal.contextual.permissionsHash', permissionsHash);
  }

  function initContextual($contextual, html) {
    var $region = $contextual.closest('.contextual-region');
    var contextual = Drupal.contextual;

    $contextual.html(html).addClass('contextual').prepend(Drupal.theme('contextualTrigger'));

    var destination = 'destination=' + Drupal.encodePath(drupalSettings.path.currentPath);
    $contextual.find('.contextual-links a').each(function () {
      var url = this.getAttribute('href');
      var glue = url.indexOf('?') === -1 ? '?' : '&';
      this.setAttribute('href', url + glue + destination);
    });

    var model = new contextual.StateModel({
      title: $region.find('h2').eq(0).text().trim()
    });
    var viewOptions = $.extend({ el: $contextual, model: model }, options);
    contextual.views.push({
      visual: new contextual.VisualView(viewOptions),
      aural: new contextual.AuralView(viewOptions),
      keyboard: new contextual.KeyboardView(viewOptions)
    });
    contextual.regionViews.push(new contextual.RegionView($.extend({ el: $region, model: model }, options)));

    contextual.collection.add(model);

    $(document).trigger('drupalContextualLinkAdded', {
      $el: $contextual,
      $region: $region,
      model: model
    });

    adjustIfNestedAndOverlapping($contextual);
  }

  function adjustIfNestedAndOverlapping($contextual) {
    var $contextuals = $contextual.parents('.contextual-region').eq(-1).find('.contextual');

    if ($contextuals.length <= 1) {
      return;
    }

    var firstTop = $contextuals.eq(0).offset().top;
    var secondTop = $contextuals.eq(1).offset().top;
    if (firstTop === secondTop) {
      var $nestedContextual = $contextuals.eq(1);

      var height = 0;
      var $trigger = $nestedContextual.find('.trigger');

      $trigger.removeClass('visually-hidden');
      height = $nestedContextual.height();
      $trigger.addClass('visually-hidden');

      $nestedContextual.css({ top: $nestedContextual.position().top + height });
    }
  }

  Drupal.behaviors.contextual = {
    attach: function attach(context) {
      var $context = $(context);

      var $placeholders = $context.find('[data-contextual-id]').once('contextual-render');
      if ($placeholders.length === 0) {
        return;
      }

      var ids = [];
      $placeholders.each(function () {
        ids.push($(this).attr('data-contextual-id'));
      });

      var uncachedIDs = _.filter(ids, function (contextualID) {
        var html = storage.getItem('Drupal.contextual.' + contextualID);
        if (html && html.length) {
          window.setTimeout(function () {
            initContextual($context.find('[data-contextual-id="' + contextualID + '"]'), html);
          });
          return false;
        }
        return true;
      });

      if (uncachedIDs.length > 0) {
        $.ajax({
          url: Drupal.url('contextual/render'),
          type: 'POST',
          data: { 'ids[]': uncachedIDs },
          dataType: 'json',
          success: function success(results) {
            _.each(results, function (html, contextualID) {
              storage.setItem('Drupal.contextual.' + contextualID, html);

              if (html.length > 0) {
                $placeholders = $context.find('[data-contextual-id="' + contextualID + '"]');

                for (var i = 0; i < $placeholders.length; i++) {
                  initContextual($placeholders.eq(i), html);
                }
              }
            });
          }
        });
      }
    }
  };

  Drupal.contextual = {
    views: [],

    regionViews: []
  };

  Drupal.contextual.collection = new Backbone.Collection([], { model: Drupal.contextual.StateModel });

  Drupal.theme.contextualTrigger = function () {
    return '<button class="trigger visually-hidden focusable" type="button"></button>';
  };

  $(document).on('drupalContextualLinkAdded', function (event, data) {
    Drupal.ajax.bindAjaxLinks(data.$el[0]);
  });

  var dialogLinkContextualButton = void 0;
  $(window).on({
    'dialog:beforecreate': function dialogBeforecreate(event, dialog, $element, settings) {
      if (settings.hasOwnProperty('drupalTriggerElement')) {
        if ($(settings.drupalTriggerElement).closest('[data-contextual-id]').find('button').length === 1) {
          dialogLinkContextualButton = $(settings.drupalTriggerElement).closest('[data-contextual-id]').find('button').get(0);
        }
      }
    },
    'dialog:afterclose': function dialogAfterclose(event, dialog, $element) {
      if (dialogLinkContextualButton) {
        $(dialogLinkContextualButton).focus();
      }
    }
  });
})(jQuery, Drupal, drupalSettings, _, Backbone, window.JSON, window.sessionStorage);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbnRleHR1YWwuZXM2LmpzIl0sIm5hbWVzIjpbIiQiLCJEcnVwYWwiLCJkcnVwYWxTZXR0aW5ncyIsIl8iLCJCYWNrYm9uZSIsIkpTT04iLCJzdG9yYWdlIiwib3B0aW9ucyIsImV4dGVuZCIsImNvbnRleHR1YWwiLCJzdHJpbmdzIiwib3BlbiIsInQiLCJjbG9zZSIsImNhY2hlZFBlcm1pc3Npb25zSGFzaCIsImdldEl0ZW0iLCJwZXJtaXNzaW9uc0hhc2giLCJ1c2VyIiwiY2hhaW4iLCJrZXlzIiwiZWFjaCIsImtleSIsInN1YnN0cmluZyIsInJlbW92ZUl0ZW0iLCJzZXRJdGVtIiwiaW5pdENvbnRleHR1YWwiLCIkY29udGV4dHVhbCIsImh0bWwiLCIkcmVnaW9uIiwiY2xvc2VzdCIsImFkZENsYXNzIiwicHJlcGVuZCIsInRoZW1lIiwiZGVzdGluYXRpb24iLCJlbmNvZGVQYXRoIiwicGF0aCIsImN1cnJlbnRQYXRoIiwiZmluZCIsInVybCIsImdldEF0dHJpYnV0ZSIsImdsdWUiLCJpbmRleE9mIiwic2V0QXR0cmlidXRlIiwibW9kZWwiLCJTdGF0ZU1vZGVsIiwidGl0bGUiLCJlcSIsInRleHQiLCJ0cmltIiwidmlld09wdGlvbnMiLCJlbCIsInZpZXdzIiwicHVzaCIsInZpc3VhbCIsIlZpc3VhbFZpZXciLCJhdXJhbCIsIkF1cmFsVmlldyIsImtleWJvYXJkIiwiS2V5Ym9hcmRWaWV3IiwicmVnaW9uVmlld3MiLCJSZWdpb25WaWV3IiwiY29sbGVjdGlvbiIsImFkZCIsImRvY3VtZW50IiwidHJpZ2dlciIsIiRlbCIsImFkanVzdElmTmVzdGVkQW5kT3ZlcmxhcHBpbmciLCIkY29udGV4dHVhbHMiLCJwYXJlbnRzIiwibGVuZ3RoIiwiZmlyc3RUb3AiLCJvZmZzZXQiLCJ0b3AiLCJzZWNvbmRUb3AiLCIkbmVzdGVkQ29udGV4dHVhbCIsImhlaWdodCIsIiR0cmlnZ2VyIiwicmVtb3ZlQ2xhc3MiLCJjc3MiLCJwb3NpdGlvbiIsImJlaGF2aW9ycyIsImF0dGFjaCIsImNvbnRleHQiLCIkY29udGV4dCIsIiRwbGFjZWhvbGRlcnMiLCJvbmNlIiwiaWRzIiwiYXR0ciIsInVuY2FjaGVkSURzIiwiZmlsdGVyIiwiY29udGV4dHVhbElEIiwid2luZG93Iiwic2V0VGltZW91dCIsImFqYXgiLCJ0eXBlIiwiZGF0YSIsImRhdGFUeXBlIiwic3VjY2VzcyIsInJlc3VsdHMiLCJpIiwiQ29sbGVjdGlvbiIsImNvbnRleHR1YWxUcmlnZ2VyIiwib24iLCJldmVudCIsImJpbmRBamF4TGlua3MiLCJkaWFsb2dMaW5rQ29udGV4dHVhbEJ1dHRvbiIsImRpYWxvZyIsIiRlbGVtZW50Iiwic2V0dGluZ3MiLCJoYXNPd25Qcm9wZXJ0eSIsImRydXBhbFRyaWdnZXJFbGVtZW50IiwiZ2V0IiwiZm9jdXMiLCJqUXVlcnkiLCJzZXNzaW9uU3RvcmFnZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUtDLFdBQVVBLENBQVYsRUFBYUMsTUFBYixFQUFxQkMsY0FBckIsRUFBcUNDLENBQXJDLEVBQXdDQyxRQUF4QyxFQUFrREMsSUFBbEQsRUFBd0RDLE9BQXhELEVBQWlFO0FBQ2hFLE1BQU1DLFVBQVVQLEVBQUVRLE1BQUYsQ0FBU04sZUFBZU8sVUFBeEIsRUFFZDtBQUNFQyxhQUFTO0FBQ1BDLFlBQU1WLE9BQU9XLENBQVAsQ0FBUyxNQUFULENBREM7QUFFUEMsYUFBT1osT0FBT1csQ0FBUCxDQUFTLE9BQVQ7QUFGQTtBQURYLEdBRmMsQ0FBaEI7O0FBWUEsTUFBTUUsd0JBQXdCUixRQUFRUyxPQUFSLENBQWdCLG1DQUFoQixDQUE5QjtBQUNBLE1BQU1DLGtCQUFrQmQsZUFBZWUsSUFBZixDQUFvQkQsZUFBNUM7QUFDQSxNQUFJRiwwQkFBMEJFLGVBQTlCLEVBQStDO0FBQzdDLFFBQUksT0FBT0EsZUFBUCxLQUEyQixRQUEvQixFQUF5QztBQUN2Q2IsUUFBRWUsS0FBRixDQUFRWixPQUFSLEVBQWlCYSxJQUFqQixHQUF3QkMsSUFBeEIsQ0FBNkIsVUFBQ0MsR0FBRCxFQUFT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QS9SckQsRUErUjJEc0YsT0FBT3VCLGNBL1JsRSxDQUFEIiwiZmlsZSI6ImNvbnRleHR1YWwuZXM2LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZmlsZVxuICogQXR0YWNoZXMgYmVoYXZpb3JzIGZvciB0aGUgQ29udGV4dHVhbCBtb2R1bGUuXG4gKi9cblxuKGZ1bmN0aW9uICgkLCBEcnVwYWwsIGRydXBhbFNldHRpbmdzLCBfLCBCYWNrYm9uZSwgSlNPTiwgc3RvcmFnZSkge1xuICBjb25zdCBvcHRpb25zID0gJC5leHRlbmQoZHJ1cGFsU2V0dGluZ3MuY29udGV4dHVhbCxcbiAgICAvLyBNZXJnZSBzdHJpbmdzIG9uIHRvcCBvZiBkcnVwYWxTZXR0aW5ncyBzbyB0aGF0IHRoZXkgYXJlIG5vdCBtdXRhYmxlLlxuICAgIHtcbiAgICAgIHN0cmluZ3M6IHtcbiAgICAgICAgb3BlbjogRHJ1cGFsLnQoJ09wZW4nKSxcbiAgICAgICAgY2xvc2U6IERydXBhbC50KCdDbG9zZScpLFxuICAgICAgfSxcbiAgICB9LFxuICApO1xuXG4gIC8vIENsZWFyIHRoZSBjYWNoZWQgY29udGV4dHVhbCBsaW5rcyB3aGVuZXZlciB0aGUgY3VycmVudCB1c2VyJ3Mgc2V0IG9mXG4gIC8vIHBlcm1pc3Npb25zIGNoYW5nZXMuXG4gIGNvbnN0IGNhY2hlZFBlcm1pc3Npb25zSGFzaCA9IHN0b3JhZ2UuZ2V0SXRlbSgnRHJ1cGFsLmNvbnRleHR1YWwucGVybWlzc2lvbnNIYXNoJyk7XG4gIGNvbnN0IHBlcm1pc3Npb25zSGFzaCA9IGRydXBhbFNldHRpbmdzLnVzZXIucGVybWlzc2lvbnNIYXNoO1xuICBpZiAoY2FjaGVkUGVybWlzc2lvbnNIYXNoICE9PSBwZXJtaXNzaW9uc0hhc2gpIHtcbiAgICBpZiAodHlwZW9mIHBlcm1pc3Npb25zSGFzaCA9PT0gJ3N0cmluZycpIHtcbiAgICAgIF8uY2hhaW4oc3RvcmFnZSkua2V5cygpLmVhY2goKGtleSkgPT4ge1xuICAgICAgICBpZiAoa2V5LnN1YnN0cmluZygwLCAxOCkgPT09ICdEcnVwYWwuY29udGV4dHVhbC4nKSB7XG4gICAgICAgICAgc3RvcmFnZS5yZW1vdmVJdGVtKGtleSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICBzdG9yYWdlLnNldEl0ZW0oJ0RydXBhbC5jb250ZXh0dWFsLnBlcm1pc3Npb25zSGFzaCcsIHBlcm1pc3Npb25zSGFzaCk7XG4gIH1cblxuICAvKipcbiAgICogSW5pdGlhbGl6ZXMgYSBjb250ZXh0dWFsIGxpbms6IHVwZGF0ZXMgaXRzIERPTSwgc2V0cyB1cCBtb2RlbCBhbmQgdmlld3MuXG4gICAqXG4gICAqIEBwYXJhbSB7alF1ZXJ5fSAkY29udGV4dHVhbFxuICAgKiAgIEEgY29udGV4dHVhbCBsaW5rcyBwbGFjZWhvbGRlciBET00gZWxlbWVudCwgY29udGFpbmluZyB0aGUgYWN0dWFsXG4gICAqICAgY29udGV4dHVhbCBsaW5rcyBhcyByZW5kZXJlZCBieSB0aGUgc2VydmVyLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gaHRtbFxuICAgKiAgIFRoZSBzZXJ2ZXItc2lkZSByZW5kZXJlZCBIVE1MIGZvciB0aGlzIGNvbnRleHR1YWwgbGluay5cbiAgICovXG4gIGZ1bmN0aW9uIGluaXRDb250ZXh0dWFsKCRjb250ZXh0dWFsLCBodG1sKSB7XG4gICAgY29uc3QgJHJlZ2lvbiA9ICRjb250ZXh0dWFsLmNsb3Nlc3QoJy5jb250ZXh0dWFsLXJlZ2lvbicpO1xuICAgIGNvbnN0IGNvbnRleHR1YWwgPSBEcnVwYWwuY29udGV4dHVhbDtcblxuICAgICRjb250ZXh0dWFsXG4gICAgICAvLyBVcGRhdGUgdGhlIHBsYWNlaG9sZGVyIHRvIGNvbnRhaW4gaXRzIHJlbmRlcmVkIGNvbnRleHR1YWwgbGlua3MuXG4gICAgICAuaHRtbChodG1sKVxuICAgICAgLy8gVXNlIHRoZSBwbGFjZWhvbGRlciBhcyBhIHdyYXBwZXIgd2l0aCBhIHNwZWNpZmljIGNsYXNzIHRvIHByb3ZpZGVcbiAgICAgIC8vIHBvc2l0aW9uaW5nIGFuZCBiZWhhdmlvciBhdHRhY2htZW50IGNvbnRleHQuXG4gICAgICAuYWRkQ2xhc3MoJ2NvbnRleHR1YWwnKVxuICAgICAgLy8gRW5zdXJlIGEgdHJpZ2dlciBlbGVtZW50IGV4aXN0cyBiZWZvcmUgdGhlIGFjdHVhbCBjb250ZXh0dWFsIGxpbmtzLlxuICAgICAgLnByZXBlbmQoRHJ1cGFsLnRoZW1lKCdjb250ZXh0dWFsVHJpZ2dlcicpKTtcblxuICAgIC8vIFNldCB0aGUgZGVzdGluYXRpb24gcGFyYW1ldGVyIG9uIGVhY2ggb2YgdGhlIGNvbnRleHR1YWwgbGlua3MuXG4gICAgY29uc3QgZGVzdGluYXRpb24gPSBgZGVzdGluYXRpb249JHtEcnVwYWwuZW5jb2RlUGF0aChkcnVwYWxTZXR0aW5ncy5wYXRoLmN1cnJlbnRQYXRoKX1gO1xuICAgICRjb250ZXh0dWFsLmZpbmQoJy5jb250ZXh0dWFsLWxpbmtzIGEnKS5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnN0IHVybCA9IHRoaXMuZ2V0QXR0cmlidXRlKCdocmVmJyk7XG4gICAgICBjb25zdCBnbHVlID0gKHVybC5pbmRleE9mKCc/JykgPT09IC0xKSA/ICc/JyA6ICcmJztcbiAgICAgIHRoaXMuc2V0QXR0cmlidXRlKCdocmVmJywgdXJsICsgZ2x1ZSArIGRlc3RpbmF0aW9uKTtcbiAgICB9KTtcblxuICAgIC8vIENyZWF0ZSBhIG1vZGVsIGFuZCB0aGUgYXBwcm9wcmlhdGUgdmlld3MuXG4gICAgY29uc3QgbW9kZWwgPSBuZXcgY29udGV4dHVhbC5TdGF0ZU1vZGVsKHtcbiAgICAgIHRpdGxlOiAkcmVnaW9uLmZpbmQoJ2gyJykuZXEoMCkudGV4dCgpLnRyaW0oKSxcbiAgICB9KTtcbiAgICBjb25zdCB2aWV3T3B0aW9ucyA9ICQuZXh0ZW5kKHsgZWw6ICRjb250ZXh0dWFsLCBtb2RlbCB9LCBvcHRpb25zKTtcbiAgICBjb250ZXh0dWFsLnZpZXdzLnB1c2goe1xuICAgICAgdmlzdWFsOiBuZXcgY29udGV4dHVhbC5WaXN1YWxWaWV3KHZpZXdPcHRpb25zKSxcbiAgICAgIGF1cmFsOiBuZXcgY29udGV4dHVhbC5BdXJhbFZpZXcodmlld09wdGlvbnMpLFxuICAgICAga2V5Ym9hcmQ6IG5ldyBjb250ZXh0dWFsLktleWJvYXJkVmlldyh2aWV3T3B0aW9ucyksXG4gICAgfSk7XG4gICAgY29udGV4dHVhbC5yZWdpb25WaWV3cy5wdXNoKG5ldyBjb250ZXh0dWFsLlJlZ2lvblZpZXcoXG4gICAgICAkLmV4dGVuZCh7IGVsOiAkcmVnaW9uLCBtb2RlbCB9LCBvcHRpb25zKSksXG4gICAgKTtcblxuICAgIC8vIEFkZCB0aGUgbW9kZWwgdG8gdGhlIGNvbGxlY3Rpb24uIFRoaXMgbXVzdCBoYXBwZW4gYWZ0ZXIgdGhlIHZpZXdzIGhhdmVcbiAgICAvLyBiZWVuIGFzc29jaWF0ZWQgd2l0aCBpdCwgb3RoZXJ3aXNlIGNvbGxlY3Rpb24gY2hhbmdlIGV2ZW50IGhhbmRsZXJzIGNhbid0XG4gICAgLy8gdHJpZ2dlciB0aGUgbW9kZWwgY2hhbmdlIGV2ZW50IGhhbmRsZXIgaW4gaXRzIHZpZXdzLlxuICAgIGNvbnRleHR1YWwuY29sbGVjdGlvbi5hZGQobW9kZWwpO1xuXG4gICAgLy8gTGV0IG90aGVyIEphdmFTY3JpcHQgcmVhY3QgdG8gdGhlIGFkZGluZyBvZiBhIG5ldyBjb250ZXh0dWFsIGxpbmsuXG4gICAgJChkb2N1bWVudCkudHJpZ2dlcignZHJ1cGFsQ29udGV4dHVhbExpbmtBZGRlZCcsIHtcbiAgICAgICRlbDogJGNvbnRleHR1YWwsXG4gICAgICAkcmVnaW9uLFxuICAgICAgbW9kZWwsXG4gICAgfSk7XG5cbiAgICAvLyBGaXggdmlzdWFsIGNvbGxpc2lvbnMgYmV0d2VlbiBjb250ZXh0dWFsIGxpbmsgdHJpZ2dlcnMuXG4gICAgYWRqdXN0SWZOZXN0ZWRBbmRPdmVybGFwcGluZygkY29udGV4dHVhbCk7XG4gIH1cblxuICAvKipcbiAgICogRGV0ZXJtaW5lcyBpZiBhIGNvbnRleHR1YWwgbGluayBpcyBuZXN0ZWQgJiBvdmVybGFwcGluZywgaWYgc286IGFkanVzdHMgaXQuXG4gICAqXG4gICAqIFRoaXMgb25seSBkZWFscyB3aXRoIHR3byBsZXZlbHMgb2YgbmVzdGluZzsgZGVlcGVyIGxldmVscyBhcmUgbm90IHRvdWNoZWQuXG4gICAqXG4gICAqIEBwYXJhbSB7alF1ZXJ5fSAkY29udGV4dHVhbFxuICAgKiAgIEEgY29udGV4dHVhbCBsaW5rcyBwbGFjZWhvbGRlciBET00gZWxlbWVudCwgY29udGFpbmluZyB0aGUgYWN0dWFsXG4gICAqICAgY29udGV4dHVhbCBsaW5rcyBhcyByZW5kZXJlZCBieSB0aGUgc2VydmVyLlxuICAgKi9cbiAgZnVuY3Rpb24gYWRqdXN0SWZOZXN0ZWRBbmRPdmVybGFwcGluZygkY29udGV4dHVhbCkge1xuICAgIGNvbnN0ICRjb250ZXh0dWFscyA9ICRjb250ZXh0dWFsXG4gICAgICAvLyBAdG9kbyBjb25maXJtIHRoYXQgLmNsb3Nlc3QoKSBpcyBub3Qgc3VmZmljaWVudFxuICAgICAgLnBhcmVudHMoJy5jb250ZXh0dWFsLXJlZ2lvbicpLmVxKC0xKVxuICAgICAgLmZpbmQoJy5jb250ZXh0dWFsJyk7XG5cbiAgICAvLyBFYXJseS1yZXR1cm4gd2hlbiB0aGVyZSdzIG5vIG5lc3RpbmcuXG4gICAgaWYgKCRjb250ZXh0dWFscy5sZW5ndGggPD0gMSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIElmIHRoZSB0d28gY29udGV4dHVhbCBsaW5rcyBvdmVybGFwLCB0aGVuIHdlIG1vdmUgdGhlIHNlY29uZCBvbmUuXG4gICAgY29uc3QgZmlyc3RUb3AgPSAkY29udGV4dHVhbHMuZXEoMCkub2Zmc2V0KCkudG9wO1xuICAgIGNvbnN0IHNlY29uZFRvcCA9ICRjb250ZXh0dWFscy5lcSgxKS5vZmZzZXQoKS50b3A7XG4gICAgaWYgKGZpcnN0VG9wID09PSBzZWNvbmRUb3ApIHtcbiAgICAgIGNvbnN0ICRuZXN0ZWRDb250ZXh0dWFsID0gJGNvbnRleHR1YWxzLmVxKDEpO1xuXG4gICAgICAvLyBSZXRyaWV2ZSBoZWlnaHQgb2YgbmVzdGVkIGNvbnRleHR1YWwgbGluay5cbiAgICAgIGxldCBoZWlnaHQgPSAwO1xuICAgICAgY29uc3QgJHRyaWdnZXIgPSAkbmVzdGVkQ29udGV4dHVhbC5maW5kKCcudHJpZ2dlcicpO1xuICAgICAgLy8gRWxlbWVudHMgd2l0aCB0aGUgLnZpc3VhbGx5LWhpZGRlbiBjbGFzcyBoYXZlIG5vIGRpbWVuc2lvbnMsIHNvIHRoaXNcbiAgICAgIC8vIGNsYXNzIG11c3QgYmUgdGVtcG9yYXJpbHkgcmVtb3ZlZCB0byB0aGUgY2FsY3VsYXRlIHRoZSBoZWlnaHQuXG4gICAgICAkdHJpZ2dlci5yZW1vdmVDbGFzcygndmlzdWFsbHktaGlkZGVuJyk7XG4gICAgICBoZWlnaHQgPSAkbmVzdGVkQ29udGV4dHVhbC5oZWlnaHQoKTtcbiAgICAgICR0cmlnZ2VyLmFkZENsYXNzKCd2aXN1YWxseS1oaWRkZW4nKTtcblxuICAgICAgLy8gQWRqdXN0IG5lc3RlZCBjb250ZXh0dWFsIGxpbmsncyBwb3NpdGlvbi5cbiAgICAgICRuZXN0ZWRDb250ZXh0dWFsLmNzcyh7IHRvcDogJG5lc3RlZENvbnRleHR1YWwucG9zaXRpb24oKS50b3AgKyBoZWlnaHQgfSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEF0dGFjaGVzIG91dGxpbmUgYmVoYXZpb3IgZm9yIHJlZ2lvbnMgYXNzb2NpYXRlZCB3aXRoIGNvbnRleHR1YWwgbGlua3MuXG4gICAqXG4gICAqIEV2ZW50c1xuICAgKiAgIENvbnRleHR1YWwgdHJpZ2dlcnMgYW4gZXZlbnQgdGhhdCBjYW4gYmUgdXNlZCBieSBvdGhlciBzY3JpcHRzLlxuICAgKiAgIC0gZHJ1cGFsQ29udGV4dHVhbExpbmtBZGRlZDogVHJpZ2dlcmVkIHdoZW4gYSBjb250ZXh0dWFsIGxpbmsgaXMgYWRkZWQuXG4gICAqXG4gICAqIEB0eXBlIHtEcnVwYWx+YmVoYXZpb3J9XG4gICAqXG4gICAqIEBwcm9wIHtEcnVwYWx+YmVoYXZpb3JBdHRhY2h9IGF0dGFjaFxuICAgKiAgQXR0YWNoZXMgdGhlIG91dGxpbmUgYmVoYXZpb3IgdG8gdGhlIHJpZ2h0IGNvbnRleHQuXG4gICAqL1xuICBEcnVwYWwuYmVoYXZpb3JzLmNvbnRleHR1YWwgPSB7XG4gICAgYXR0YWNoKGNvbnRleHQpIHtcbiAgICAgIGNvbnN0ICRjb250ZXh0ID0gJChjb250ZXh0KTtcblxuICAgICAgLy8gRmluZCBhbGwgY29udGV4dHVhbCBsaW5rcyBwbGFjZWhvbGRlcnMsIGlmIGFueS5cbiAgICAgIGxldCAkcGxhY2Vob2xkZXJzID0gJGNvbnRleHQuZmluZCgnW2RhdGEtY29udGV4dHVhbC1pZF0nKS5vbmNlKCdjb250ZXh0dWFsLXJlbmRlcicpO1xuICAgICAgaWYgKCRwbGFjZWhvbGRlcnMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgLy8gQ29sbGVjdCB0aGUgSURzIGZvciBhbGwgY29udGV4dHVhbCBsaW5rcyBwbGFjZWhvbGRlcnMuXG4gICAgICBjb25zdCBpZHMgPSBbXTtcbiAgICAgICRwbGFjZWhvbGRlcnMuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlkcy5wdXNoKCQodGhpcykuYXR0cignZGF0YS1jb250ZXh0dWFsLWlkJykpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIFVwZGF0ZSBhbGwgY29udGV4dHVhbCBsaW5rcyBwbGFjZWhvbGRlcnMgd2hvc2UgSFRNTCBpcyBjYWNoZWQuXG4gICAgICBjb25zdCB1bmNhY2hlZElEcyA9IF8uZmlsdGVyKGlkcywgKGNvbnRleHR1YWxJRCkgPT4ge1xuICAgICAgICBjb25zdCBodG1sID0gc3RvcmFnZS5nZXRJdGVtKGBEcnVwYWwuY29udGV4dHVhbC4ke2NvbnRleHR1YWxJRH1gKTtcbiAgICAgICAgaWYgKGh0bWwgJiYgaHRtbC5sZW5ndGgpIHtcbiAgICAgICAgICAvLyBJbml0aWFsaXplIGFmdGVyIHRoZSBjdXJyZW50IGV4ZWN1dGlvbiBjeWNsZSwgdG8gbWFrZSB0aGUgQUpBWFxuICAgICAgICAgIC8vIHJlcXVlc3QgZm9yIHJldHJpZXZpbmcgdGhlIHVuY2FjaGVkIGNvbnRleHR1YWwgbGlua3MgYXMgc29vbiBhc1xuICAgICAgICAgIC8vIHBvc3NpYmxlLCBidXQgYWxzbyB0byBlbnN1cmUgdGhhdCBvdGhlciBEcnVwYWwgYmVoYXZpb3JzIGhhdmUgaGFkXG4gICAgICAgICAgLy8gdGhlIGNoYW5jZSB0byBzZXQgdXAgYW4gZXZlbnQgbGlzdGVuZXIgb24gdGhlIEJhY2tib25lIGNvbGxlY3Rpb25cbiAgICAgICAgICAvLyBEcnVwYWwuY29udGV4dHVhbC5jb2xsZWN0aW9uLlxuICAgICAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIGluaXRDb250ZXh0dWFsKCRjb250ZXh0LmZpbmQoYFtkYXRhLWNvbnRleHR1YWwtaWQ9XCIke2NvbnRleHR1YWxJRH1cIl1gKSwgaHRtbCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIFBlcmZvcm0gYW4gQUpBWCByZXF1ZXN0IHRvIGxldCB0aGUgc2VydmVyIHJlbmRlciB0aGUgY29udGV4dHVhbCBsaW5rc1xuICAgICAgLy8gZm9yIGVhY2ggb2YgdGhlIHBsYWNlaG9sZGVycy5cbiAgICAgIGlmICh1bmNhY2hlZElEcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICQuYWpheCh7XG4gICAgICAgICAgdXJsOiBEcnVwYWwudXJsKCdjb250ZXh0dWFsL3JlbmRlcicpLFxuICAgICAgICAgIHR5cGU6ICdQT1NUJyxcbiAgICAgICAgICBkYXRhOiB7ICdpZHNbXSc6IHVuY2FjaGVkSURzIH0sXG4gICAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgICBzdWNjZXNzKHJlc3VsdHMpIHtcbiAgICAgICAgICAgIF8uZWFjaChyZXN1bHRzLCAoaHRtbCwgY29udGV4dHVhbElEKSA9PiB7XG4gICAgICAgICAgICAgIC8vIFN0b3JlIHRoZSBtZXRhZGF0YS5cbiAgICAgICAgICAgICAgc3RvcmFnZS5zZXRJdGVtKGBEcnVwYWwuY29udGV4dHVhbC4ke2NvbnRleHR1YWxJRH1gLCBodG1sKTtcbiAgICAgICAgICAgICAgLy8gSWYgdGhlIHJlbmRlcmVkIGNvbnRleHR1YWwgbGlua3MgYXJlIGVtcHR5LCB0aGVuIHRoZSBjdXJyZW50XG4gICAgICAgICAgICAgIC8vIHVzZXIgZG9lcyBub3QgaGF2ZSBwZXJtaXNzaW9uIHRvIGFjY2VzcyB0aGUgYXNzb2NpYXRlZCBsaW5rczpcbiAgICAgICAgICAgICAgLy8gZG9uJ3QgcmVuZGVyIGFueXRoaW5nLlxuICAgICAgICAgICAgICBpZiAoaHRtbC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgLy8gVXBkYXRlIHRoZSBwbGFjZWhvbGRlcnMgdG8gY29udGFpbiBpdHMgcmVuZGVyZWQgY29udGV4dHVhbFxuICAgICAgICAgICAgICAgIC8vIGxpbmtzLiBVc3VhbGx5IHRoZXJlIHdpbGwgb25seSBiZSBvbmUgcGxhY2Vob2xkZXIsIGJ1dCBpdCdzXG4gICAgICAgICAgICAgICAgLy8gcG9zc2libGUgZm9yIG11bHRpcGxlIGlkZW50aWNhbCBwbGFjZWhvbGRlcnMgZXhpc3Qgb24gdGhlXG4gICAgICAgICAgICAgICAgLy8gcGFnZSAocHJvYmFibHkgYmVjYXVzZSB0aGUgc2FtZSBjb250ZW50IGFwcGVhcnMgbW9yZSB0aGFuXG4gICAgICAgICAgICAgICAgLy8gb25jZSkuXG4gICAgICAgICAgICAgICAgJHBsYWNlaG9sZGVycyA9ICRjb250ZXh0LmZpbmQoYFtkYXRhLWNvbnRleHR1YWwtaWQ9XCIke2NvbnRleHR1YWxJRH1cIl1gKTtcblxuICAgICAgICAgICAgICAgIC8vIEluaXRpYWxpemUgdGhlIGNvbnRleHR1YWwgbGlua3MuXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAkcGxhY2Vob2xkZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICBpbml0Q29udGV4dHVhbCgkcGxhY2Vob2xkZXJzLmVxKGkpLCBodG1sKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0sXG4gIH07XG5cbiAgLyoqXG4gICAqIE5hbWVzcGFjZSBmb3IgY29udGV4dHVhbCByZWxhdGVkIGZ1bmN0aW9uYWxpdHkuXG4gICAqXG4gICAqIEBuYW1lc3BhY2VcbiAgICovXG4gIERydXBhbC5jb250ZXh0dWFsID0ge1xuXG4gICAgLyoqXG4gICAgICogVGhlIHtAbGluayBEcnVwYWwuY29udGV4dHVhbC5WaWV3fSBpbnN0YW5jZXMgYXNzb2NpYXRlZCB3aXRoIGVhY2ggbGlzdFxuICAgICAqIGVsZW1lbnQgb2YgY29udGV4dHVhbCBsaW5rcy5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtBcnJheX1cbiAgICAgKi9cbiAgICB2aWV3czogW10sXG5cbiAgICAvKipcbiAgICAgKiBUaGUge0BsaW5rIERydXBhbC5jb250ZXh0dWFsLlJlZ2lvblZpZXd9IGluc3RhbmNlcyBhc3NvY2lhdGVkIHdpdGggZWFjaFxuICAgICAqIGNvbnRleHR1YWwgcmVnaW9uIGVsZW1lbnQuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7QXJyYXl9XG4gICAgICovXG4gICAgcmVnaW9uVmlld3M6IFtdLFxuICB9O1xuXG4gIC8qKlxuICAgKiBBIEJhY2tib25lLkNvbGxlY3Rpb24gb2Yge0BsaW5rIERydXBhbC5jb250ZXh0dWFsLlN0YXRlTW9kZWx9IGluc3RhbmNlcy5cbiAgICpcbiAgICogQHR5cGUge0JhY2tib25lLkNvbGxlY3Rpb259XG4gICAqL1xuICBEcnVwYWwuY29udGV4dHVhbC5jb2xsZWN0aW9uID0gbmV3IEJhY2tib25lLkNvbGxlY3Rpb24oW10sIHsgbW9kZWw6IERydXBhbC5jb250ZXh0dWFsLlN0YXRlTW9kZWwgfSk7XG5cbiAgLyoqXG4gICAqIEEgdHJpZ2dlciBpcyBhbiBpbnRlcmFjdGl2ZSBlbGVtZW50IG9mdGVuIGJvdW5kIHRvIGEgY2xpY2sgaGFuZGxlci5cbiAgICpcbiAgICogQHJldHVybiB7c3RyaW5nfVxuICAgKiAgIEEgc3RyaW5nIHJlcHJlc2VudGluZyBhIERPTSBmcmFnbWVudC5cbiAgICovXG4gIERydXBhbC50aGVtZS5jb250ZXh0dWFsVHJpZ2dlciA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gJzxidXR0b24gY2xhc3M9XCJ0cmlnZ2VyIHZpc3VhbGx5LWhpZGRlbiBmb2N1c2FibGVcIiB0eXBlPVwiYnV0dG9uXCI+PC9idXR0b24+JztcbiAgfTtcblxuICAvKipcbiAgICogQmluZCBBamF4IGNvbnRleHR1YWwgbGlua3Mgd2hlbiBhZGRlZC5cbiAgICpcbiAgICogQHBhcmFtIHtqUXVlcnkuRXZlbnR9IGV2ZW50XG4gICAqICAgVGhlIGBkcnVwYWxDb250ZXh0dWFsTGlua0FkZGVkYCBldmVudC5cbiAgICogQHBhcmFtIHtvYmplY3R9IGRhdGFcbiAgICogICBBbiBvYmplY3QgY29udGFpbmluZyB0aGUgZGF0YSByZWxldmFudCB0byB0aGUgZXZlbnQuXG4gICAqXG4gICAqIEBsaXN0ZW5zIGV2ZW50OmRydXBhbENvbnRleHR1YWxMaW5rQWRkZWRcbiAgICovXG4gICQoZG9jdW1lbnQpLm9uKCdkcnVwYWxDb250ZXh0dWFsTGlua0FkZGVkJywgKGV2ZW50LCBkYXRhKSA9PiB7XG4gICAgRHJ1cGFsLmFqYXguYmluZEFqYXhMaW5rcyhkYXRhLiRlbFswXSk7XG4gIH0pO1xuXG4gIC8vIFRoZSBjb250ZXh0dWFsIGJ1dHRvbiBmb3IgdGhlIGxpbmsgdGhhdCBvcGVuZWQgdGhlIGRpYWxvZy5cbiAgbGV0IGRpYWxvZ0xpbmtDb250ZXh0dWFsQnV0dG9uO1xuICAkKHdpbmRvdykub24oe1xuICAgICdkaWFsb2c6YmVmb3JlY3JlYXRlJzogKGV2ZW50LCBkaWFsb2csICRlbGVtZW50LCBzZXR0aW5ncykgPT4ge1xuICAgICAgaWYgKHNldHRpbmdzLmhhc093blByb3BlcnR5KCdkcnVwYWxUcmlnZ2VyRWxlbWVudCcpKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTYXZlIHRyaWdnZXIgZWxlbWVudCBzbyBpdCB3aWxsIGJlIGF2YWlsYWJsZSBmb3IgJ2RpYWxvZzphZnRlcmNsb3NlJ1xuICAgICAgICAgKiBldmVudC5cbiAgICAgICAgICovXG4gICAgICAgIGlmICgkKHNldHRpbmdzLmRydXBhbFRyaWdnZXJFbGVtZW50KS5jbG9zZXN0KCdbZGF0YS1jb250ZXh0dWFsLWlkXScpLmZpbmQoJ2J1dHRvbicpLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgIGRpYWxvZ0xpbmtDb250ZXh0dWFsQnV0dG9uID0gJChzZXR0aW5ncy5kcnVwYWxUcmlnZ2VyRWxlbWVudClcbiAgICAgICAgICAgIC5jbG9zZXN0KCdbZGF0YS1jb250ZXh0dWFsLWlkXScpXG4gICAgICAgICAgICAuZmluZCgnYnV0dG9uJylcbiAgICAgICAgICAgIC5nZXQoMCk7XG4gICAgICAgIH1cblxuXG4gICAgICB9XG4gICAgfSxcbiAgICAnZGlhbG9nOmFmdGVyY2xvc2UnOiAoZXZlbnQsIGRpYWxvZywgJGVsZW1lbnQpID0+IHtcbiAgICAgIGlmIChkaWFsb2dMaW5rQ29udGV4dHVhbEJ1dHRvbikge1xuICAgICAgICAvLyBTZXQgZm9jdXMgdG8gdGhlIGNvbnRleHR1YWwgdHJpZ2dlciBidXR0b24uXG4gICAgICAgICQoZGlhbG9nTGlua0NvbnRleHR1YWxCdXR0b24pLmZvY3VzKCk7XG4gICAgICB9XG4gICAgfSxcbiAgfSk7XG59KGpRdWVyeSwgRHJ1cGFsLCBkcnVwYWxTZXR0aW5ncywgXywgQmFja2JvbmUsIHdpbmRvdy5KU09OLCB3aW5kb3cuc2Vzc2lvblN0b3JhZ2UpKTtcbiJdfQ==