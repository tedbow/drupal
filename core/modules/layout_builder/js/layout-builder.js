/**
* DO NOT EDIT THIS FILE.
* See the following change record for more information,
* https://www.drupal.org/node/2815083
* @preserve
**/

(function ($, _ref) {
  var ajax = _ref.ajax,
      behaviors = _ref.behaviors;

  function getComponentRegion(component) {
    return component.closest('[data-region]');
  }

  function getSection(element) {
    return element.closest('.layout-section');
  }

  function getComponentLayoutDelta(element) {
    return element.closest('[data-layout-delta]').data('layout-delta');
  }

  function getSiblingByDirection(element, direction, selector) {
    if (direction === 'previous') {
      return element.prevAll(selector).first();
    }
    return element.nextAll(selector).first();
  }

  function findMoveToRegion(element, direction) {
    var elementRegion = getComponentRegion(element);
    var moveToRegion = getSiblingByDirection(elementRegion, direction, '[data-region]');
    if (moveToRegion.length === 0) {
      var componentSection = getSection(elementRegion);
      var moveToSection = getSiblingByDirection(componentSection, direction, '.layout-section');
      if (moveToSection.length === 0) {
        return null;
      }
      var sectionRegions = moveToSection.find('[data-region]');
      return direction === 'previous' ? sectionRegions.last() : sectionRegions.first();
    } else {
      return moveToRegion;
    }
  }

  function findRegionMoveToElement(region, element, direction) {
    var moveToElement = void 0;
    if (region[0] === getComponentRegion(element)[0]) {
      if (direction === 'previous') {
        moveToElement = element.prev('[data-layout-block-uuid]');
      } else {
        moveToElement = element.next('[data-layout-block-uuid], .new-block').next('[data-layout-block-uuid], .new-block');
      }
      if (moveToElement.length === 0) {
        var moveToRegion = findMoveToRegion(element, direction);
        if (moveToRegion) {
          return findRegionMoveToElement(moveToRegion, element, direction);
        } else {
          return null;
        }
      }
    } else {
      if (direction === 'next') {
        moveToElement = region.children('[data-layout-block-uuid], .new-block').first();
      } else {
        moveToElement = region.find('.new-block');
      }
    }

    return moveToElement.length === 0 ? null : moveToElement;
  }

  function moveComponent(element, direction) {
    var moveToElement = findRegionMoveToElement(getComponentRegion(element), element, direction);
    if (moveToElement) {
      element.addClass('updating');
      var deltaFrom = getComponentLayoutDelta(element);
      moveToElement.before(element);
      updateComponentPosition(element, deltaFrom, direction);
    }
  }

  function updateComponentPosition(item, deltaFrom) {
    var directionFocus = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 'none';

    var itemRegion = item.closest('.layout-builder--layout__region');

    var deltaTo = getComponentLayoutDelta(item);
    ajax({
      progress: { type: 'fullscreen' },
      url: [item.closest('[data-layout-update-url]').data('layout-update-url'), deltaFrom, deltaTo, itemRegion.data('region'), item.data('layout-block-uuid'), directionFocus, item.prev('[data-layout-block-uuid]').data('layout-block-uuid')].filter(function (element) {
        return element !== undefined;
      }).join('/')
    }).execute();
  }

  behaviors.layoutBuilder = {
    attach: function attach(context) {
      $(context).find('.layout-builder--layout__region').sortable({
        items: '> .draggable',
        connectWith: '.layout-builder--layout__region',
        placeholder: 'ui-state-drop',

        update: function update(event, ui) {
          var itemRegion = ui.item.closest('.layout-builder--layout__region');
          if (event.target === itemRegion[0]) {

            var deltaTo = getComponentLayoutDelta(ui.item);

            var deltaFrom = ui.sender ? getComponentLayoutDelta(ui.sender) : deltaTo;
            updateComponentPosition(ui.item, deltaFrom);
          }
        }
      });
      $(context).find('[data-layout-builder-reorder] [data-layout-builder-reorder-direction]').on('click', function (e) {
        var direction = $(e.target).attr('data-layout-builder-reorder-direction');
        moveComponent($(e.target).closest('[data-layout-block-uuid]'), direction);
        e.preventDefault();
      });
    }
  };
})(jQuery, Drupal);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxheW91dC1idWlsZGVyLmVzNi5qcyJdLCJuYW1lcyI6WyIkIiwiYWpheCIsImJlaGF2aW9ycyIsImdldENvbXBvbmVudFJlZ2lvbiIsImNvbXBvbmVudCIsImNsb3Nlc3QiLCJnZXRTZWN0aW9uIiwiZWxlbWVudCIsImdldENvbXBvbmVudExheW91dERlbHRhIiwiZGF0YSIsImdldFNpYmxpbmdCeURpcmVjdGlvbiIsImRpcmVjdGlvbiIsInNlbGVjdG9yIiwicHJldkFsbCIsImZpcnN0IiwibmV4dEFsbCIsImZpbmRNb3ZlVG9SZWdpb24iLCJlbGVtZW50UmVnaW9uIiwibW92ZVRvUmVnaW9uIiwibGVuZ3RoIiwiY29tcG9uZW50U2VjdGlvbiIsIm1vdmVUb1NlY3Rpb24iLCJzZWN0aW9uUmVnaW9ucyIsImZpbmQiLCJsYXN0IiwiZmluZFJlZ2lvbk1vdmVUb0VsZW1lbnQiLCJyZWdpb24iLCJtb3ZlVG9FbGVtZW50IiwicHJldiIsIm5leHQiLCJjaGlsZHJlbiIsIm1vdmVDb21wb25lbnQiLCJhZGRDbGFzcyIsImRlbHRhRnJvbSIsImJlZm9yZSIsInVwZGF0ZUNvbXBvbmVudFBvc2l0aW9uIiwiaXRlbSIsImRpcmVjdGlvbkZvY3VzIiwiaXRlbVJlZ2lvbiIsImRlbHRhVG8iLCJwcm9ncmVzcyIsInR5cGUiLCJ1cmwiLCJmaWx0ZXIiLCJ1bmRlZmluZWQiLCJqb2luIiwiZXhlY3V0ZSIsImxheW91dEJ1aWxkZXIiLCJhdHRhY2giLCJjb250ZXh0Iiwic29ydGFibGUiLCJpdGVtcyIsImNvbm5lY3RXaXRoIiwicGxhY2Vob2xkZXIiLCJ1cGRhdGUiLCJldmVudCIsInVpIiwidGFyZ2V0Iiwic2VuZGVyIiwib24iLCJlIiwiYXR0ciIsInByZXZlbnREZWZhdWx0IiwialF1ZXJ5IiwiRHJ1cGFsIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUEsQ0FBQyxVQUFDQSxDQUFELFFBQTRCO0FBQUEsTUFBdEJDLElBQXNCLFFBQXRCQSxJQUFzQjtBQUFBLE1BQWhC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RCxPQUFGLEVBQ0cxQixJQURILENBQ1EsaUNBRFIsRUFFRzJCLFFBRkgsQ0FFWTtBQUNSQyxlQUFPLGNBREM7QUFFUkMscUJBQWEsaUNBRkw7QUFHUkMscUJBQWEsZUFITDs7QUFhUkMsY0FiUSxrQkFhREMsS0FiQyxFQWFNQyxFQWJOLEVBYVU7QUFFaEIsY0FBTWxCLGFBQWFrQixHQUFHcEIsSUFBSCxDQUFRL0IsT0FBUixDQUNqQixpQ0FEaUIsQ0FBbkI7QUFHQSxjQUFJa0QsTUFBTUUsTUFBTixLQUFpQm5CLFdBQVcsQ0FBWCxDQUFyQixFQUFvQzs7QUFFbEMsZ0JBQU1DLFVBQVUvQix3QkFBd0JnRCxHQUFHcEIsSUFBM0IsQ0FBaEI7O0FBRUEsZ0JBQU1ILFlBQVl1QixHQUFHRSxNQUFILEdBQ2RsRCx3QkFBd0JnRCxHQUFHRSxNQUEzQixDQURjLEdBRWRuQixPQUZKO0FBR0FKLG9DQUF3QnFCLEdBQUdwQixJQUEzQixFQUFpQ0gsU0FBakM7QUFFRDtBQUNGO0FBNUJPLE9BRlo7QUFnQ0FqQyxRQUFFaUQsT0FBRixFQUNHMUIsSUFESCxDQUVJLHVFQUZKLEVBSUdvQyxFQUpILENBSU0sT0FKTixFQUllLGFBQUs7QUFDaEIsWUFBTWhELFlBQVlYLEVBQUU0RCxFQUFFSCxNQUFKLEVBQVlJLElBQVosQ0FDaEIsdUNBRGdCLENBQWxCO0FBR0E5QixzQkFBYy9CLEVBQUU0RCxFQUFFSCxNQUFKLEVBQVlwRCxPQUFaLENBQW9CLDBCQUFwQixDQUFkLEVBQStETSxTQUEvRDtBQUNBaUQsVUFBRUUsY0FBRjtBQUNELE9BVkg7QUFXRDtBQTdDdUIsR0FBMUI7QUErQ0QsQ0E1TUQsRUE0TUdDLE1BNU1ILEVBNE1XQyxNQTVNWCIsImZpbGUiOiJsYXlvdXQtYnVpbGRlci5lczYuanMiLCJzb3VyY2VzQ29udGVudCI6WyIoKCQsIHsgYWpheCwgYmVoYXZpb3JzIH0pID0+IHtcbiAgLyoqXG4gICAqIEdldHMgdGhlIHJlZ2lvbiBmb3IgYSBjb21wb25lbnQuXG4gICAqXG4gICAqIEBwYXJhbSB7alF1ZXJ5fSBjb21wb25lbnRcbiAgICogICBUaGUgY29tcG9uZW50LlxuICAgKiBAcmV0dXJuIHtqUXVlcnl9XG4gICAqICAgVGhlIGNvbXBvbmVudHMgcmVnaW9uIGVsZW1lbnQuXG4gICAqL1xuICBmdW5jdGlvbiBnZXRDb21wb25lbnRSZWdpb24oY29tcG9uZW50KSB7XG4gICAgcmV0dXJuIGNvbXBvbmVudC5jbG9zZXN0KCdbZGF0YS1yZWdpb25dJyk7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRTZWN0aW9uKGVsZW1lbnQpIHtcbiAgICByZXR1cm4gZWxlbWVudC5jbG9zZXN0KCcubGF5b3V0LXNlY3Rpb24nKTtcbiAgfVxuICBcbiAgZnVuY3Rpb24gZ2V0Q29tcG9uZW50TGF5b3V0RGVsdGEoZWxlbWVudCkge1xuICAgIHJldHVybiBlbGVtZW50LmNsb3Nlc3QoJ1tkYXRhLWxheW91dC1kZWx0YV0nKS5kYXRhKCdsYXlvdXQtZGVsdGEnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSBuZXh0IG1hdGNoaW5nIHNpYmxpbmcuXG4gICAqXG4gICAqIEBwYXJhbSB7alF1ZXJ5fSBlbGVtZW50XG4gICAqICAgVGhlIGVsZW1lbnQgdG8gZ2V0IHRoZSBzaWJsaW5nIGZvci5cbiAgICogQHBhcmFtIGRpcmVjdGlvblxuICAgKiBAcGFyYW0gc2VsZWN0b3JcbiAgICogQHJldHVybiB7alF1ZXJ5fVxuICAgKiAgIFRoZSBzaWJsaW5nIHRoYXQgbWF0Y2ggdGhlIHNlbGVjdG9yLlxuICAgKi9cbiAgZnVuY3Rpb24gZ2V0U2libGluZ0J5RGlyZWN0aW9uKGVsZW1lbnQsIGRpcmVjdGlvbiwgc2VsZWN0b3IpIHtcbiAgICBpZiAoZGlyZWN0aW9uID09PSAncHJldmlvdXMnKSB7XG4gICAgICByZXR1cm4gZWxlbWVudC5wcmV2QWxsKHNlbGVjdG9yKS5maXJzdCgpO1xuICAgIH1cbiAgICByZXR1cm4gZWxlbWVudC5uZXh0QWxsKHNlbGVjdG9yKS5maXJzdCgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEZpbmRzIHRoZSByZWdpb24gdG8gbW92ZSB0by5cbiAgICpcbiAgICogQHBhcmFtIGVsZW1lbnRcbiAgICogQHBhcmFtIGRpcmVjdGlvblxuICAgKiBAcmV0dXJucyB7Kn1cbiAgICovXG4gIGZ1bmN0aW9uIGZpbmRNb3ZlVG9SZWdpb24oZWxlbWVudCwgZGlyZWN0aW9uKSB7XG4gICAgY29uc3QgZWxlbWVudFJlZ2lvbiA9IGdldENvbXBvbmVudFJlZ2lvbihlbGVtZW50KTtcbiAgICBjb25zdCBtb3ZlVG9SZWdpb24gPSBnZXRTaWJsaW5nQnlEaXJlY3Rpb24oXG4gICAgICBlbGVtZW50UmVnaW9uLFxuICAgICAgZGlyZWN0aW9uLFxuICAgICAgJ1tkYXRhLXJlZ2lvbl0nLFxuICAgICk7XG4gICAgaWYgKG1vdmVUb1JlZ2lvbi5sZW5ndGggPT09IDApIHtcbiAgICAgIGNvbnN0IGNvbXBvbmVudFNlY3Rpb24gPSBnZXRTZWN0aW9uKGVsZW1lbnRSZWdpb24pO1xuICAgICAgY29uc3QgbW92ZVRvU2VjdGlvbiA9IGdldFNpYmxpbmdCeURpcmVjdGlvbihcbiAgICAgICAgY29tcG9uZW50U2VjdGlvbixcbiAgICAgICAgZGlyZWN0aW9uLFxuICAgICAgICAnLmxheW91dC1zZWN0aW9uJyxcbiAgICAgICk7XG4gICAgICBpZiAobW92ZVRvU2VjdGlvbi5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG4gICAgICBjb25zdCBzZWN0aW9uUmVnaW9ucyA9IG1vdmVUb1NlY3Rpb24uZmluZCgnW2RhdGEtcmVnaW9uXScpO1xuICAgICAgcmV0dXJuIGRpcmVjdGlvbiA9PT0gJ3ByZXZpb3VzJ1xuICAgICAgICA/IHNlY3Rpb25SZWdpb25zLmxhc3QoKVxuICAgICAgICA6IHNlY3Rpb25SZWdpb25zLmZpcnN0KCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBtb3ZlVG9SZWdpb247XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEZpbmRzIHRoZSBlbGVtZW50cyB0aGUgZWxlbWVudCB0aGUgY3VycmVudCBlbGVtZW50IHNob3VsZCBtb3ZlIHRvLlxuICAgKlxuICAgKiBAcGFyYW0gcmVnaW9uXG4gICAqIEBwYXJhbSBlbGVtZW50XG4gICAqIEBwYXJhbSBkaXJlY3Rpb25cbiAgICogQHJldHVybnMge251bGx9XG4gICAqL1xuICBmdW5jdGlvbiBmaW5kUmVnaW9uTW92ZVRvRWxlbWVudChyZWdpb24sIGVsZW1lbnQsIGRpcmVjdGlvbikge1xuICAgIGxldCBtb3ZlVG9FbGVtZW50O1xuICAgIGlmIChyZWdpb25bMF0gPT09IGdldENvbXBvbmVudFJlZ2lvbihlbGVtZW50KVswXSkge1xuICAgICAgaWYgKGRpcmVjdGlvbiA9PT0gJ3ByZXZpb3VzJykge1xuICAgICAgICBtb3ZlVG9FbGVtZW50ID0gZWxlbWVudC5wcmV2KCdbZGF0YS1sYXlvdXQtYmxvY2stdXVpZF0nKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG1vdmVUb0VsZW1lbnQgPSBlbGVtZW50XG4gICAgICAgICAgLm5leHQoJ1tkYXRhLWxheW91dC1ibG9jay11dWlkXSwgLm5ldy1ibG9jaycpXG4gICAgICAgICAgLm5leHQoJ1tkYXRhLWxheW91dC1ibG9jay11dWlkXSwgLm5ldy1ibG9jaycpO1xuICAgICAgfVxuICAgICAgaWYgKG1vdmVUb0VsZW1lbnQubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIGNvbnN0IG1vdmVUb1JlZ2lvbiA9IGZpbmRNb3ZlVG9SZWdpb24oZWxlbWVudCwgZGlyZWN0aW9uKTtcbiAgICAgICAgaWYgKG1vdmVUb1JlZ2lvbikge1xuICAgICAgICAgIHJldHVybiBmaW5kUmVnaW9uTW92ZVRvRWxlbWVudChtb3ZlVG9SZWdpb24sIGVsZW1lbnQsIGRpcmVjdGlvbik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKGRpcmVjdGlvbiA9PT0gJ25leHQnKSB7XG4gICAgICAgIG1vdmVUb0VsZW1lbnQgPSByZWdpb25cbiAgICAgICAgICAuY2hpbGRyZW4oJ1tkYXRhLWxheW91dC1ibG9jay11dWlkXSwgLm5ldy1ibG9jaycpXG4gICAgICAgICAgLmZpcnN0KCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBtb3ZlVG9FbGVtZW50ID0gcmVnaW9uLmZpbmQoJy5uZXctYmxvY2snKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gbW92ZVRvRWxlbWVudC5sZW5ndGggPT09IDAgPyBudWxsIDogbW92ZVRvRWxlbWVudDtcbiAgfVxuXG4gIC8qKlxuICAgKiBNb3ZlIHRoZSBjb21wb25lbnQgaW4gYSBkaXJlY3Rpb24uXG4gICAqXG4gICAqIEBwYXJhbSBlbGVtZW50XG4gICAqIEBwYXJhbSBkaXJlY3Rpb25cbiAgICovXG4gIGZ1bmN0aW9uIG1vdmVDb21wb25lbnQoZWxlbWVudCwgZGlyZWN0aW9uKSB7XG4gICAgY29uc3QgbW92ZVRvRWxlbWVudCA9IGZpbmRSZWdpb25Nb3ZlVG9FbGVtZW50KFxuICAgICAgZ2V0Q29tcG9uZW50UmVnaW9uKGVsZW1lbnQpLFxuICAgICAgZWxlbWVudCxcbiAgICAgIGRpcmVjdGlvbixcbiAgICApO1xuICAgIGlmIChtb3ZlVG9FbGVtZW50KSB7XG4gICAgICBlbGVtZW50LmFkZENsYXNzKCd1cGRhdGluZycpO1xuICAgICAgY29uc3QgZGVsdGFGcm9tID0gZ2V0Q29tcG9uZW50TGF5b3V0RGVsdGEoZWxlbWVudCk7XG4gICAgICBtb3ZlVG9FbGVtZW50LmJlZm9yZShlbGVtZW50KTtcbiAgICAgIHVwZGF0ZUNvbXBvbmVudFBvc2l0aW9uKGVsZW1lbnQsIGRlbHRhRnJvbSwgZGlyZWN0aW9uKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiB1cGRhdGVDb21wb25lbnRQb3NpdGlvbihpdGVtLCBkZWx0YUZyb20sIGRpcmVjdGlvbkZvY3VzID0gJ25vbmUnKSB7XG4gICAgY29uc3QgaXRlbVJlZ2lvbiA9IGl0ZW0uY2xvc2VzdChcbiAgICAgICAgJy5sYXlvdXQtYnVpbGRlci0tbGF5b3V0X19yZWdpb24nLFxuICAgICk7XG4gICAgLy8gRmluZCB0aGUgZGVzdGluYXRpb24gZGVsdGEuXG4gICAgY29uc3QgZGVsdGFUbyA9IGdldENvbXBvbmVudExheW91dERlbHRhKGl0ZW0pO1xuICAgIGFqYXgoe1xuICAgICAgcHJvZ3Jlc3M6IHsgdHlwZTogJ2Z1bGxzY3JlZW4nIH0sXG4gICAgICB1cmw6IFtcbiAgICAgICAgaXRlbVxuICAgICAgICAgICAgLmNsb3Nlc3QoJ1tkYXRhLWxheW91dC11cGRhdGUtdXJsXScpXG4gICAgICAgICAgICAuZGF0YSgnbGF5b3V0LXVwZGF0ZS11cmwnKSxcbiAgICAgICAgZGVsdGFGcm9tLFxuICAgICAgICBkZWx0YVRvLFxuICAgICAgICBpdGVtUmVnaW9uLmRhdGEoJ3JlZ2lvbicpLFxuICAgICAgICBpdGVtLmRhdGEoJ2xheW91dC1ibG9jay11dWlkJyksXG4gICAgICAgIGRpcmVjdGlvbkZvY3VzLFxuICAgICAgICBpdGVtXG4gICAgICAgICAgICAucHJldignW2RhdGEtbGF5b3V0LWJsb2NrLXV1aWRdJylcbiAgICAgICAgICAgIC5kYXRhKCdsYXlvdXQtYmxvY2stdXVpZCcpLFxuXG4gICAgICBdXG4gICAgICAgICAgLmZpbHRlcihlbGVtZW50ID0+IGVsZW1lbnQgIT09IHVuZGVmaW5lZClcbiAgICAgICAgICAuam9pbignLycpLFxuICAgIH0pLmV4ZWN1dGUoKTtcbiAgfVxuXG4gIGJlaGF2aW9ycy5sYXlvdXRCdWlsZGVyID0ge1xuICAgIGF0dGFjaChjb250ZXh0KSB7XG4gICAgICAkKGNvbnRleHQpXG4gICAgICAgIC5maW5kKCcubGF5b3V0LWJ1aWxkZXItLWxheW91dF9fcmVnaW9uJylcbiAgICAgICAgLnNvcnRhYmxlKHtcbiAgICAgICAgICBpdGVtczogJz4gLmRyYWdnYWJsZScsXG4gICAgICAgICAgY29ubmVjdFdpdGg6ICcubGF5b3V0LWJ1aWxkZXItLWxheW91dF9fcmVnaW9uJyxcbiAgICAgICAgICBwbGFjZWhvbGRlcjogJ3VpLXN0YXRlLWRyb3AnLFxuXG4gICAgICAgICAgLyoqXG4gICAgICAgICAgICogVXBkYXRlcyB0aGUgbGF5b3V0IHdpdGggdGhlIG5ldyBwb3NpdGlvbiBvZiB0aGUgYmxvY2suXG4gICAgICAgICAgICpcbiAgICAgICAgICAgKiBAcGFyYW0ge2pRdWVyeS5FdmVudH0gZXZlbnRcbiAgICAgICAgICAgKiAgIFRoZSBqUXVlcnkgRXZlbnQgb2JqZWN0LlxuICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSB1aVxuICAgICAgICAgICAqICAgQW4gb2JqZWN0IGNvbnRhaW5pbmcgaW5mb3JtYXRpb24gYWJvdXQgdGhlIGl0ZW0gYmVpbmcgc29ydGVkLlxuICAgICAgICAgICAqL1xuICAgICAgICAgIHVwZGF0ZShldmVudCwgdWkpIHtcbiAgICAgICAgICAgIC8vIENoZWNrIGlmIHRoZSByZWdpb24gZnJvbSB0aGUgZXZlbnQgYW5kIHJlZ2lvbiBmb3IgdGhlIGl0ZW0gbWF0Y2guXG4gICAgICAgICAgICBjb25zdCBpdGVtUmVnaW9uID0gdWkuaXRlbS5jbG9zZXN0KFxuICAgICAgICAgICAgICAnLmxheW91dC1idWlsZGVyLS1sYXlvdXRfX3JlZ2lvbicsXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgaWYgKGV2ZW50LnRhcmdldCA9PT0gaXRlbVJlZ2lvblswXSkge1xuXG4gICAgICAgICAgICAgIGNvbnN0IGRlbHRhVG8gPSBnZXRDb21wb25lbnRMYXlvdXREZWx0YSh1aS5pdGVtKTtcbiAgICAgICAgICAgICAgLy8gSWYgdGhlIGJsb2NrIGRpZG4ndCBsZWF2ZSB0aGUgb3JpZ2luYWwgZGVsdGEgdXNlIHRoZSBkZXN0aW5hdGlvbi5cbiAgICAgICAgICAgICAgY29uc3QgZGVsdGFGcm9tID0gdWkuc2VuZGVyXG4gICAgICAgICAgICAgICAgPyBnZXRDb21wb25lbnRMYXlvdXREZWx0YSh1aS5zZW5kZXIpXG4gICAgICAgICAgICAgICAgOiBkZWx0YVRvO1xuICAgICAgICAgICAgICB1cGRhdGVDb21wb25lbnRQb3NpdGlvbih1aS5pdGVtLCBkZWx0YUZyb20pO1xuXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgICAkKGNvbnRleHQpXG4gICAgICAgIC5maW5kKFxuICAgICAgICAgICdbZGF0YS1sYXlvdXQtYnVpbGRlci1yZW9yZGVyXSBbZGF0YS1sYXlvdXQtYnVpbGRlci1yZW9yZGVyLWRpcmVjdGlvbl0nLFxuICAgICAgICApXG4gICAgICAgIC5vbignY2xpY2snLCBlID0+IHtcbiAgICAgICAgICBjb25zdCBkaXJlY3Rpb24gPSAkKGUudGFyZ2V0KS5hdHRyKFxuICAgICAgICAgICAgJ2RhdGEtbGF5b3V0LWJ1aWxkZXItcmVvcmRlci1kaXJlY3Rpb24nLFxuICAgICAgICAgICk7XG4gICAgICAgICAgbW92ZUNvbXBvbmVudCgkKGUudGFyZ2V0KS5jbG9zZXN0KCdbZGF0YS1sYXlvdXQtYmxvY2stdXVpZF0nKSwgZGlyZWN0aW9uKTtcbiAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH0pO1xuICAgIH0sXG4gIH07XG59KShqUXVlcnksIERydXBhbCk7XG4iXX0=