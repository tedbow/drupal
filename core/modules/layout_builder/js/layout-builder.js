/**
* DO NOT EDIT THIS FILE.
* See the following change record for more information,
* https://www.drupal.org/node/2815083
* @preserve
**/

(function ($, _ref) {
  var ajax = _ref.ajax,
      behaviors = _ref.behaviors;

  function getComponentRegion(component) {
    return component.closest('[data-region]');
  }

  function getSection(element) {
    return element.closest('.layout-section');
  }

  function getComponentLayoutDelta(element) {
    return element.closest('[data-layout-delta]').data('layout-delta');
  }

  function getSiblingByDirection(element, direction, selector) {
    if (direction === 'previous') {
      return element.prevAll(selector).first();
    }
    return element.nextAll(selector).first();
  }

  function findMoveToRegion(element, direction) {
    var elementRegion = getComponentRegion(element);
    var moveToRegion = getSiblingByDirection(elementRegion, direction, '[data-region]');
    if (moveToRegion.length === 0) {
      var componentSection = getSection(elementRegion);
      var moveToSection = getSiblingByDirection(componentSection, direction, '.layout-section');
      if (moveToSection.length === 0) {
        return null;
      }
      var sectionRegions = moveToSection.find('[data-region]');
      return direction === 'previous' ? sectionRegions.last() : sectionRegions.first();
    } else {
      return moveToRegion;
    }
  }

  function findRegionMoveToElement(region, element, direction) {
    var moveToElement = void 0;
    if (region[0] === getComponentRegion(element)[0]) {
      if (direction === 'previous') {
        moveToElement = element.prev('[data-layout-block-uuid]');
      } else {
        moveToElement = element.next('[data-layout-block-uuid], .new-block').next('[data-layout-block-uuid], .new-block');
      }
      if (moveToElement.length === 0) {
        var moveToRegion = findMoveToRegion(element, direction);
        if (moveToRegion) {
          return findRegionMoveToElement(moveToRegion, element, direction);
        } else {
          return null;
        }
      }
    } else {
      if (direction === 'next') {
        moveToElement = region.children('[data-layout-block-uuid], .new-block').first();
      } else {
        moveToElement = region.find('.new-block');
      }
    }

    return moveToElement.length === 0 ? null : moveToElement;
  }

  function moveComponent(element, direction) {
    var moveToElement = findRegionMoveToElement(getComponentRegion(element), element, direction);
    if (moveToElement) {
      element.addClass('updating');
      var deltaFrom = getComponentLayoutDelta(element);
      moveToElement.before(element);
      updateComponentPosition(element, deltaFrom, direction);
    }
  }

  function updateComponentPosition(item, deltaFrom) {
    var directionFocus = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 'none';

    var itemRegion = item.closest('.layout-builder--layout__region');

    var deltaTo = getComponentLayoutDelta(item);
    ajax({
      url: [item.closest('[data-layout-update-url]').data('layout-update-url'), deltaFrom, deltaTo, itemRegion.data('region'), item.data('layout-block-uuid'), directionFocus, item.prev('[data-layout-block-uuid]').data('layout-block-uuid')].filter(function (element) {
        return element !== undefined;
      }).join('/')
    }).execute();
  }

  behaviors.layoutBuilder = {
    attach: function attach(context) {
      $(context).find('.layout-builder--layout__region').sortable({
        items: '> .draggable',
        connectWith: '.layout-builder--layout__region',
        placeholder: 'ui-state-drop',

        update: function update(event, ui) {
          var itemRegion = ui.item.closest('.layout-builder--layout__region');
          if (event.target === itemRegion[0]) {

            var deltaTo = getComponentLayoutDelta(ui.item);

            var deltaFrom = ui.sender ? getComponentLayoutDelta(ui.sender) : deltaTo;
            updateComponentPosition(ui.item, deltaFrom);
          }
        }
      });
      $(context).find('[data-layout-builder-reorder] [data-layout-builder-reorder-direction]').on('click', function (e) {
        var direction = $(e.target).attr('data-layout-builder-reorder-direction');
        moveComponent($(e.target).closest('[data-layout-block-uuid]'), direction);
        e.preventDefault();
      });
    }
  };
})(jQuery, Drupal);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxheW91dC1idWlsZGVyLmVzNi5qcyJdLCJuYW1lcyI6WyIkIiwiYWpheCIsImJlaGF2aW9ycyIsImdldENvbXBvbmVudFJlZ2lvbiIsImNvbXBvbmVudCIsImNsb3Nlc3QiLCJnZXRTZWN0aW9uIiwiZWxlbWVudCIsImdldENvbXBvbmVudExheW91dERlbHRhIiwiZGF0YSIsImdldFNpYmxpbmdCeURpcmVjdGlvbiIsImRpcmVjdGlvbiIsInNlbGVjdG9yIiwicHJldkFsbCIsImZpcnN0IiwibmV4dEFsbCIsImZpbmRNb3ZlVG9SZWdpb24iLCJlbGVtZW50UmVnaW9uIiwibW92ZVRvUmVnaW9uIiwibGVuZ3RoIiwiY29tcG9uZW50U2VjdGlvbiIsIm1vdmVUb1NlY3Rpb24iLCJzZWN0aW9uUmVnaW9ucyIsImZpbmQiLCJsYXN0IiwiZmluZFJlZ2lvbk1vdmVUb0VsZW1lbnQiLCJyZWdpb24iLCJtb3ZlVG9FbGVtZW50IiwicHJldiIsIm5leHQiLCJjaGlsZHJlbiIsIm1vdmVDb21wb25lbnQiLCJhZGRDbGFzcyIsImRlbHRhRnJvbSIsImJlZm9yZSIsInVwZGF0ZUNvbXBvbmVudFBvc2l0aW9uIiwiaXRlbSIsImRpcmVjdGlvbkZvY3VzIiwiaXRlbVJlZ2lvbiIsImRlbHRhVG8iLCJ1cmwiLCJmaWx0ZXIiLCJ1bmRlZmluZWQiLCJqb2luIiwiZXhlY3V0ZSIsImxheW91dEJ1aWxkZXIiLCJhdHRhY2giLCJjb250ZXh0Iiwic29ydGFibGUiLCJpdGVtcyIsImNvbm5lY3RXaXRoIiwicGxhY2Vob2xkZXIiLCJ1cGRhdGUiLCJldmVudCIsInVpIiwidGFyZ2V0Iiwic2VuZGVyIiwib24iLCJlIiwiYXR0ciIsInByZXZlbnREZWZhdWx0IiwialF1ZXJ5IiwiRHJ1cGFsIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUEsQ0FBQyxVQUFDQSxDQUFELFFBQTRCO0FBQUEsTUFBdEJDLElBQXNCLFFBQXRCQSxJQUFzQjtBQUFBLE1BQWhCQyxTQUFnQixRQUFoQkEsU0FB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QyxlQUFPLGNBREM7QUFFUkMscUJBQWEsaUNBRkw7QUFHUkMscUJBQWEsZUFITDs7QUFhUkMsY0FiUSxrQkFhREMsS0FiQyxFQWFNQyxFQWJOLEVBYVU7QUFFaEIsY0FBTWhCLGFBQWFnQixHQUFHbEIsSUFBSCxDQUFRL0IsT0FBUixDQUNqQixpQ0FEaUIsQ0FBbkI7QUFHQSxjQUFJZ0QsTUFBTUUsTUFBTixLQUFpQmpCLFdBQVcsQ0FBWCxDQUFyQixFQUFvQzs7QUFFbEMsZ0JBQU1DLFVBQVUvQix3QkFBd0I4QyxHQUFHbEIsSUFBM0IsQ0FBaEI7O0FBRUEsZ0JBQU1ILFlBQVlxQixHQUFHRSxNQUFILEdBQ2RoRCx3QkFBd0I4QyxHQUFHRSxNQUEzQixDQURjLEdBRWRqQixPQUZKO0FBR0FKLG9DQUF3Qm1CLEdBQUdsQixJQUEzQixFQUFpQ0gsU0FBakM7QUFFRDtBQUNGO0FBNUJPLE9BRlo7QUFnQ0FqQyxRQUFFK0MsT0FBRixFQUNHeEIsSUFESCxDQUVJLHVFQUZKLEVBSUdrQyxFQUpILENBSU0sT0FKTixFQUllLGFBQUs7QUFDaEIsWUFBTTlDLFlBQVlYLEVBQUUwRCxFQUFFSCxNQUFKLEVBQVlJLElBQVosQ0FDaEIsdUNBRGdCLENBQWxCO0FBR0E1QixzQkFBYy9CLEVBQUUwRCxFQUFFSCxNQUFKLEVBQVlsRCxPQUFaLENBQW9CLDBCQUFwQixDQUFkLEVBQStETSxTQUEvRDtBQUNBK0MsVUFBRUUsY0FBRjtBQUNELE9BVkg7QUFXRDtBQTdDdUIsR0FBMUI7QUErQ0QsQ0EzTUQsRUEyTUdDLE1BM01ILEVBMk1XQyxNQTNNWCIsImZpbGUiOiJsYXlvdXQtYnVpbGRlci5lczYuanMiLCJzb3VyY2VzQ29udGVudCI6WyIoKCQsIHsgYWpheCwgYmVoYXZpb3JzIH0pID0+IHtcbiAgLyoqXG4gICAqIEdldHMgdGhlIHJlZ2lvbiBmb3IgYSBjb21wb25lbnQuXG4gICAqXG4gICAqIEBwYXJhbSB7alF1ZXJ5fSBjb21wb25lbnRcbiAgICogICBUaGUgY29tcG9uZW50LlxuICAgKiBAcmV0dXJuIHtqUXVlcnl9XG4gICAqICAgVGhlIGNvbXBvbmVudHMgcmVnaW9uIGVsZW1lbnQuXG4gICAqL1xuICBmdW5jdGlvbiBnZXRDb21wb25lbnRSZWdpb24oY29tcG9uZW50KSB7XG4gICAgcmV0dXJuIGNvbXBvbmVudC5jbG9zZXN0KCdbZGF0YS1yZWdpb25dJyk7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRTZWN0aW9uKGVsZW1lbnQpIHtcbiAgICByZXR1cm4gZWxlbWVudC5jbG9zZXN0KCcubGF5b3V0LXNlY3Rpb24nKTtcbiAgfVxuICBcbiAgZnVuY3Rpb24gZ2V0Q29tcG9uZW50TGF5b3V0RGVsdGEoZWxlbWVudCkge1xuICAgIHJldHVybiBlbGVtZW50LmNsb3Nlc3QoJ1tkYXRhLWxheW91dC1kZWx0YV0nKS5kYXRhKCdsYXlvdXQtZGVsdGEnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSBuZXh0IG1hdGNoaW5nIHNpYmxpbmcuXG4gICAqXG4gICAqIEBwYXJhbSB7alF1ZXJ5fSBlbGVtZW50XG4gICAqICAgVGhlIGVsZW1lbnQgdG8gZ2V0IHRoZSBzaWJsaW5nIGZvci5cbiAgICogQHBhcmFtIGRpcmVjdGlvblxuICAgKiBAcGFyYW0gc2VsZWN0b3JcbiAgICogQHJldHVybiB7alF1ZXJ5fVxuICAgKiAgIFRoZSBzaWJsaW5nIHRoYXQgbWF0Y2ggdGhlIHNlbGVjdG9yLlxuICAgKi9cbiAgZnVuY3Rpb24gZ2V0U2libGluZ0J5RGlyZWN0aW9uKGVsZW1lbnQsIGRpcmVjdGlvbiwgc2VsZWN0b3IpIHtcbiAgICBpZiAoZGlyZWN0aW9uID09PSAncHJldmlvdXMnKSB7XG4gICAgICByZXR1cm4gZWxlbWVudC5wcmV2QWxsKHNlbGVjdG9yKS5maXJzdCgpO1xuICAgIH1cbiAgICByZXR1cm4gZWxlbWVudC5uZXh0QWxsKHNlbGVjdG9yKS5maXJzdCgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEZpbmRzIHRoZSByZWdpb24gdG8gbW92ZSB0by5cbiAgICpcbiAgICogQHBhcmFtIGVsZW1lbnRcbiAgICogQHBhcmFtIGRpcmVjdGlvblxuICAgKiBAcmV0dXJucyB7Kn1cbiAgICovXG4gIGZ1bmN0aW9uIGZpbmRNb3ZlVG9SZWdpb24oZWxlbWVudCwgZGlyZWN0aW9uKSB7XG4gICAgY29uc3QgZWxlbWVudFJlZ2lvbiA9IGdldENvbXBvbmVudFJlZ2lvbihlbGVtZW50KTtcbiAgICBjb25zdCBtb3ZlVG9SZWdpb24gPSBnZXRTaWJsaW5nQnlEaXJlY3Rpb24oXG4gICAgICBlbGVtZW50UmVnaW9uLFxuICAgICAgZGlyZWN0aW9uLFxuICAgICAgJ1tkYXRhLXJlZ2lvbl0nLFxuICAgICk7XG4gICAgaWYgKG1vdmVUb1JlZ2lvbi5sZW5ndGggPT09IDApIHtcbiAgICAgIGNvbnN0IGNvbXBvbmVudFNlY3Rpb24gPSBnZXRTZWN0aW9uKGVsZW1lbnRSZWdpb24pO1xuICAgICAgY29uc3QgbW92ZVRvU2VjdGlvbiA9IGdldFNpYmxpbmdCeURpcmVjdGlvbihcbiAgICAgICAgY29tcG9uZW50U2VjdGlvbixcbiAgICAgICAgZGlyZWN0aW9uLFxuICAgICAgICAnLmxheW91dC1zZWN0aW9uJyxcbiAgICAgICk7XG4gICAgICBpZiAobW92ZVRvU2VjdGlvbi5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG4gICAgICBjb25zdCBzZWN0aW9uUmVnaW9ucyA9IG1vdmVUb1NlY3Rpb24uZmluZCgnW2RhdGEtcmVnaW9uXScpO1xuICAgICAgcmV0dXJuIGRpcmVjdGlvbiA9PT0gJ3ByZXZpb3VzJ1xuICAgICAgICA/IHNlY3Rpb25SZWdpb25zLmxhc3QoKVxuICAgICAgICA6IHNlY3Rpb25SZWdpb25zLmZpcnN0KCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBtb3ZlVG9SZWdpb247XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEZpbmRzIHRoZSBlbGVtZW50cyB0aGUgZWxlbWVudCB0aGUgY3VycmVudCBlbGVtZW50IHNob3VsZCBtb3ZlIHRvLlxuICAgKlxuICAgKiBAcGFyYW0gcmVnaW9uXG4gICAqIEBwYXJhbSBlbGVtZW50XG4gICAqIEBwYXJhbSBkaXJlY3Rpb25cbiAgICogQHJldHVybnMge251bGx9XG4gICAqL1xuICBmdW5jdGlvbiBmaW5kUmVnaW9uTW92ZVRvRWxlbWVudChyZWdpb24sIGVsZW1lbnQsIGRpcmVjdGlvbikge1xuICAgIGxldCBtb3ZlVG9FbGVtZW50O1xuICAgIGlmIChyZWdpb25bMF0gPT09IGdldENvbXBvbmVudFJlZ2lvbihlbGVtZW50KVswXSkge1xuICAgICAgaWYgKGRpcmVjdGlvbiA9PT0gJ3ByZXZpb3VzJykge1xuICAgICAgICBtb3ZlVG9FbGVtZW50ID0gZWxlbWVudC5wcmV2KCdbZGF0YS1sYXlvdXQtYmxvY2stdXVpZF0nKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG1vdmVUb0VsZW1lbnQgPSBlbGVtZW50XG4gICAgICAgICAgLm5leHQoJ1tkYXRhLWxheW91dC1ibG9jay11dWlkXSwgLm5ldy1ibG9jaycpXG4gICAgICAgICAgLm5leHQoJ1tkYXRhLWxheW91dC1ibG9jay11dWlkXSwgLm5ldy1ibG9jaycpO1xuICAgICAgfVxuICAgICAgaWYgKG1vdmVUb0VsZW1lbnQubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIGNvbnN0IG1vdmVUb1JlZ2lvbiA9IGZpbmRNb3ZlVG9SZWdpb24oZWxlbWVudCwgZGlyZWN0aW9uKTtcbiAgICAgICAgaWYgKG1vdmVUb1JlZ2lvbikge1xuICAgICAgICAgIHJldHVybiBmaW5kUmVnaW9uTW92ZVRvRWxlbWVudChtb3ZlVG9SZWdpb24sIGVsZW1lbnQsIGRpcmVjdGlvbik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKGRpcmVjdGlvbiA9PT0gJ25leHQnKSB7XG4gICAgICAgIG1vdmVUb0VsZW1lbnQgPSByZWdpb25cbiAgICAgICAgICAuY2hpbGRyZW4oJ1tkYXRhLWxheW91dC1ibG9jay11dWlkXSwgLm5ldy1ibG9jaycpXG4gICAgICAgICAgLmZpcnN0KCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBtb3ZlVG9FbGVtZW50ID0gcmVnaW9uLmZpbmQoJy5uZXctYmxvY2snKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gbW92ZVRvRWxlbWVudC5sZW5ndGggPT09IDAgPyBudWxsIDogbW92ZVRvRWxlbWVudDtcbiAgfVxuXG4gIC8qKlxuICAgKiBNb3ZlIHRoZSBjb21wb25lbnQgaW4gYSBkaXJlY3Rpb24uXG4gICAqXG4gICAqIEBwYXJhbSBlbGVtZW50XG4gICAqIEBwYXJhbSBkaXJlY3Rpb25cbiAgICovXG4gIGZ1bmN0aW9uIG1vdmVDb21wb25lbnQoZWxlbWVudCwgZGlyZWN0aW9uKSB7XG4gICAgY29uc3QgbW92ZVRvRWxlbWVudCA9IGZpbmRSZWdpb25Nb3ZlVG9FbGVtZW50KFxuICAgICAgZ2V0Q29tcG9uZW50UmVnaW9uKGVsZW1lbnQpLFxuICAgICAgZWxlbWVudCxcbiAgICAgIGRpcmVjdGlvbixcbiAgICApO1xuICAgIGlmIChtb3ZlVG9FbGVtZW50KSB7XG4gICAgICBlbGVtZW50LmFkZENsYXNzKCd1cGRhdGluZycpO1xuICAgICAgY29uc3QgZGVsdGFGcm9tID0gZ2V0Q29tcG9uZW50TGF5b3V0RGVsdGEoZWxlbWVudCk7XG4gICAgICBtb3ZlVG9FbGVtZW50LmJlZm9yZShlbGVtZW50KTtcbiAgICAgIHVwZGF0ZUNvbXBvbmVudFBvc2l0aW9uKGVsZW1lbnQsIGRlbHRhRnJvbSwgZGlyZWN0aW9uKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiB1cGRhdGVDb21wb25lbnRQb3NpdGlvbihpdGVtLCBkZWx0YUZyb20sIGRpcmVjdGlvbkZvY3VzID0gJ25vbmUnKSB7XG4gICAgY29uc3QgaXRlbVJlZ2lvbiA9IGl0ZW0uY2xvc2VzdChcbiAgICAgICAgJy5sYXlvdXQtYnVpbGRlci0tbGF5b3V0X19yZWdpb24nLFxuICAgICk7XG4gICAgLy8gRmluZCB0aGUgZGVzdGluYXRpb24gZGVsdGEuXG4gICAgY29uc3QgZGVsdGFUbyA9IGdldENvbXBvbmVudExheW91dERlbHRhKGl0ZW0pO1xuICAgIGFqYXgoe1xuICAgICAgdXJsOiBbXG4gICAgICAgIGl0ZW1cbiAgICAgICAgICAgIC5jbG9zZXN0KCdbZGF0YS1sYXlvdXQtdXBkYXRlLXVybF0nKVxuICAgICAgICAgICAgLmRhdGEoJ2xheW91dC11cGRhdGUtdXJsJyksXG4gICAgICAgIGRlbHRhRnJvbSxcbiAgICAgICAgZGVsdGFUbyxcbiAgICAgICAgaXRlbVJlZ2lvbi5kYXRhKCdyZWdpb24nKSxcbiAgICAgICAgaXRlbS5kYXRhKCdsYXlvdXQtYmxvY2stdXVpZCcpLFxuICAgICAgICBkaXJlY3Rpb25Gb2N1cyxcbiAgICAgICAgaXRlbVxuICAgICAgICAgICAgLnByZXYoJ1tkYXRhLWxheW91dC1ibG9jay11dWlkXScpXG4gICAgICAgICAgICAuZGF0YSgnbGF5b3V0LWJsb2NrLXV1aWQnKSxcblxuICAgICAgXVxuICAgICAgICAgIC5maWx0ZXIoZWxlbWVudCA9PiBlbGVtZW50ICE9PSB1bmRlZmluZWQpXG4gICAgICAgICAgLmpvaW4oJy8nKSxcbiAgICB9KS5leGVjdXRlKCk7XG4gIH1cblxuICBiZWhhdmlvcnMubGF5b3V0QnVpbGRlciA9IHtcbiAgICBhdHRhY2goY29udGV4dCkge1xuICAgICAgJChjb250ZXh0KVxuICAgICAgICAuZmluZCgnLmxheW91dC1idWlsZGVyLS1sYXlvdXRfX3JlZ2lvbicpXG4gICAgICAgIC5zb3J0YWJsZSh7XG4gICAgICAgICAgaXRlbXM6ICc+IC5kcmFnZ2FibGUnLFxuICAgICAgICAgIGNvbm5lY3RXaXRoOiAnLmxheW91dC1idWlsZGVyLS1sYXlvdXRfX3JlZ2lvbicsXG4gICAgICAgICAgcGxhY2Vob2xkZXI6ICd1aS1zdGF0ZS1kcm9wJyxcblxuICAgICAgICAgIC8qKlxuICAgICAgICAgICAqIFVwZGF0ZXMgdGhlIGxheW91dCB3aXRoIHRoZSBuZXcgcG9zaXRpb24gb2YgdGhlIGJsb2NrLlxuICAgICAgICAgICAqXG4gICAgICAgICAgICogQHBhcmFtIHtqUXVlcnkuRXZlbnR9IGV2ZW50XG4gICAgICAgICAgICogICBUaGUgalF1ZXJ5IEV2ZW50IG9iamVjdC5cbiAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gdWlcbiAgICAgICAgICAgKiAgIEFuIG9iamVjdCBjb250YWluaW5nIGluZm9ybWF0aW9uIGFib3V0IHRoZSBpdGVtIGJlaW5nIHNvcnRlZC5cbiAgICAgICAgICAgKi9cbiAgICAgICAgICB1cGRhdGUoZXZlbnQsIHVpKSB7XG4gICAgICAgICAgICAvLyBDaGVjayBpZiB0aGUgcmVnaW9uIGZyb20gdGhlIGV2ZW50IGFuZCByZWdpb24gZm9yIHRoZSBpdGVtIG1hdGNoLlxuICAgICAgICAgICAgY29uc3QgaXRlbVJlZ2lvbiA9IHVpLml0ZW0uY2xvc2VzdChcbiAgICAgICAgICAgICAgJy5sYXlvdXQtYnVpbGRlci0tbGF5b3V0X19yZWdpb24nLFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGlmIChldmVudC50YXJnZXQgPT09IGl0ZW1SZWdpb25bMF0pIHtcblxuICAgICAgICAgICAgICBjb25zdCBkZWx0YVRvID0gZ2V0Q29tcG9uZW50TGF5b3V0RGVsdGEodWkuaXRlbSk7XG4gICAgICAgICAgICAgIC8vIElmIHRoZSBibG9jayBkaWRuJ3QgbGVhdmUgdGhlIG9yaWdpbmFsIGRlbHRhIHVzZSB0aGUgZGVzdGluYXRpb24uXG4gICAgICAgICAgICAgIGNvbnN0IGRlbHRhRnJvbSA9IHVpLnNlbmRlclxuICAgICAgICAgICAgICAgID8gZ2V0Q29tcG9uZW50TGF5b3V0RGVsdGEodWkuc2VuZGVyKVxuICAgICAgICAgICAgICAgIDogZGVsdGFUbztcbiAgICAgICAgICAgICAgdXBkYXRlQ29tcG9uZW50UG9zaXRpb24odWkuaXRlbSwgZGVsdGFGcm9tKTtcblxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgICAgJChjb250ZXh0KVxuICAgICAgICAuZmluZChcbiAgICAgICAgICAnW2RhdGEtbGF5b3V0LWJ1aWxkZXItcmVvcmRlcl0gW2RhdGEtbGF5b3V0LWJ1aWxkZXItcmVvcmRlci1kaXJlY3Rpb25dJyxcbiAgICAgICAgKVxuICAgICAgICAub24oJ2NsaWNrJywgZSA9PiB7XG4gICAgICAgICAgY29uc3QgZGlyZWN0aW9uID0gJChlLnRhcmdldCkuYXR0cihcbiAgICAgICAgICAgICdkYXRhLWxheW91dC1idWlsZGVyLXJlb3JkZXItZGlyZWN0aW9uJyxcbiAgICAgICAgICApO1xuICAgICAgICAgIG1vdmVDb21wb25lbnQoJChlLnRhcmdldCkuY2xvc2VzdCgnW2RhdGEtbGF5b3V0LWJsb2NrLXV1aWRdJyksIGRpcmVjdGlvbik7XG4gICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9KTtcbiAgICB9LFxuICB9O1xufSkoalF1ZXJ5LCBEcnVwYWwpO1xuIl19